"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
/**
 * @license
 * Copyright Google Inc. All Rights Reserved.
 *
 * Use of this source code is governed by an MIT-style license that can be
 * found in the LICENSE file at https://angular.io/license
 */
// tslint:disable:no-implicit-dependencies
const core_1 = require("@angular-devkit/core");
const glob = require("glob");
require("jasmine");
const jasmine_spec_reporter_1 = require("jasmine-spec-reporter");
const path_1 = require("path");
const Jasmine = require('jasmine');
const projectBaseDir = path_1.join(__dirname, '../packages');
require('source-map-support').install({
    hookRequire: true,
});
class BenchmarkReporter extends jasmine_spec_reporter_1.SpecReporter {
    constructor() {
        super({
            summary: {},
        });
    }
    reportBenchmark(stats) {
        this._stats = stats;
    }
    jasmineStarted(suiteInfo) {
        super.jasmineStarted(suiteInfo);
    }
    suiteStarted(result) {
        super.suiteStarted(result);
    }
    specStarted(result) {
        super.specStarted(result);
        this._stats = null;
    }
    specDone(result) {
        super.specDone(result);
        if (result.status == 'passed' && this._stats) {
            const stat = this._stats;
            const padding = '             ';
            function pad(x, p = padding) {
                const s = ('' + x).replace(/\B(?=(\d{3})+(?!\d))/g, ' ');
                return p.substr(0, p.length - ('' + s).length) + s;
            }
            const fastest = stat.fastest.map(x => pad(x)).join('');
            const slowest = stat.slowest.map(x => pad(x)).join('');
            const mean = pad(Math.floor(stat.mean));
            const average = pad(Math.floor(stat.average));
            if (stat.base) {
                const precision = (x) => ('' + Math.floor(x * 100)).replace(/(\d\d)$/, '.$1');
                const multPad = '      ';
                const baseFastest = stat.base.fastest.map(x => pad(x)).join('');
                const baseSlowest = stat.base.slowest.map(x => pad(x)).join('');
                const baseMean = pad(Math.floor(stat.base.mean));
                const baseMeanMult = pad(precision(stat.mean / stat.base.mean), multPad);
                const baseAverage = pad(Math.floor(stat.base.average));
                const baseAverageMult = pad(precision(stat.average / stat.base.average), multPad);
                console.log(core_1.terminal.colors.yellow(core_1.tags.indentBy(6) `
          fastest: ${fastest}
            (base) ${baseFastest}
          slowest: ${slowest}
            (base) ${baseSlowest}
          mean:    ${mean} (${baseMean}) (${baseMeanMult}x)
          average: ${average} (${baseAverage}) (${baseAverageMult}x)
        `));
            }
            else {
                console.log(core_1.terminal.colors.yellow(core_1.tags.indentBy(6) `
          fastest: ${fastest}
          slowest: ${slowest}
          mean:    ${mean}
          average: ${average}
        `));
            }
        }
    }
    suiteDone(result) {
        super.suiteDone(result);
    }
    jasmineDone(runDetails) {
        super.jasmineDone(runDetails);
    }
}
// Create a Jasmine runner and configure it.
const runner = new Jasmine({ projectBaseDir: projectBaseDir });
runner.env.clearReporters();
global.benchmarkReporter = new BenchmarkReporter();
runner.env.addReporter(global.benchmarkReporter);
// Manually set exit code (needed with custom reporters)
runner.onComplete((success) => {
    process.exitCode = success ? 0 : 1;
});
// Run the tests.
const allTests = glob.sync('packages/**/*_benchmark.ts')
    .map(p => path_1.relative(projectBaseDir, p))
    .filter(p => !/schematics_cli\/schematics\//.test(p));
function default_1(_args) {
    runner.execute(allTests);
}
exports.default = default_1;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYmVuY2htYXJrLmpzIiwic291cmNlUm9vdCI6Ii9Vc2Vycy9lcm5pZWRhdmlzL0NvZGUvYW5ndWxhci1jbGkvIiwic291cmNlcyI6WyJzY3JpcHRzL2JlbmNobWFyay50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOztBQUFBOzs7Ozs7R0FNRztBQUNILDBDQUEwQztBQUMxQywrQ0FBc0Q7QUFDdEQsNkJBQTZCO0FBQzdCLG1CQUFpQjtBQUNqQixpRUFBNEU7QUFDNUUsK0JBQXNDO0FBR3RDLE1BQU0sT0FBTyxHQUFHLE9BQU8sQ0FBQyxTQUFTLENBQUMsQ0FBQztBQUVuQyxNQUFNLGNBQWMsR0FBRyxXQUFJLENBQUMsU0FBUyxFQUFFLGFBQWEsQ0FBQyxDQUFDO0FBQ3RELE9BQU8sQ0FBQyxvQkFBb0IsQ0FBQyxDQUFDLE9BQU8sQ0FBQztJQUNwQyxXQUFXLEVBQUUsSUFBSTtDQUNsQixDQUFDLENBQUM7QUFrQkgsdUJBQXdCLFNBQVEsb0NBQW1CO0lBR2pEO1FBQ0UsS0FBSyxDQUFDO1lBQ0osT0FBTyxFQUFFLEVBQUU7U0FDWixDQUFDLENBQUM7SUFDTCxDQUFDO0lBRUQsZUFBZSxDQUFDLEtBQXNCO1FBQ3BDLElBQUksQ0FBQyxNQUFNLEdBQUcsS0FBSyxDQUFDO0lBQ3RCLENBQUM7SUFFRCxjQUFjLENBQUMsU0FBNEI7UUFDekMsS0FBSyxDQUFDLGNBQWMsQ0FBQyxTQUFTLENBQUMsQ0FBQztJQUNsQyxDQUFDO0lBQ0QsWUFBWSxDQUFDLE1BQW9DO1FBQy9DLEtBQUssQ0FBQyxZQUFZLENBQUMsTUFBTSxDQUFDLENBQUM7SUFDN0IsQ0FBQztJQUNELFdBQVcsQ0FBQyxNQUFvQztRQUM5QyxLQUFLLENBQUMsV0FBVyxDQUFDLE1BQU0sQ0FBQyxDQUFDO1FBQzFCLElBQUksQ0FBQyxNQUFNLEdBQUcsSUFBSSxDQUFDO0lBQ3JCLENBQUM7SUFDRCxRQUFRLENBQUMsTUFBb0M7UUFDM0MsS0FBSyxDQUFDLFFBQVEsQ0FBQyxNQUFNLENBQUMsQ0FBQztRQUN2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O0tBQ3BDLEdBQUcsQ0FBQyxDQUFDLENBQUMsRUFBRSxDQUFDLGVBQVEsQ0FBQyxjQUFjLEVBQUUsQ0FBQyxDQUFDLENBQUM7S0FDckMsTUFBTSxDQUFDLENBQUMsQ0FBQyxFQUFFLENBQUMsQ0FBQyw4QkFBOEIsQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQztBQUcxRCxtQkFBd0IsS0FBUztJQUMvQixNQUFNLENBQUMsT0FBTyxDQUFDLFFBQVEsQ0FBQyxDQUFDO0FBQzNCLENBQUM7QUFGRCw0QkFFQyIsInNvdXJjZXNDb250ZW50IjpbIi8qKlxuICogQGxpY2Vuc2VcbiAqIENvcHlyaWdodCBHb29nbGUgSW5jLiBBbGwgUmlnaHRzIFJlc2VydmVkLlxuICpcbiAqIFVzZSBvZiB0aGlzIHNvdXJjZSBjb2RlIGlzIGdvdmVybmVkIGJ5IGFuIE1JVC1zdHlsZSBsaWNlbnNlIHRoYXQgY2FuIGJlXG4gKiBmb3VuZCBpbiB0aGUgTElDRU5TRSBmaWxlIGF0IGh0dHBzOi8vYW5ndWxhci5pby9saWNlbnNlXG4gKi9cbi8vIHRzbGludDpkaXNhYmxlOm5vLWltcGxpY2l0LWRlcGVuZGVuY2llc1xuaW1wb3J0IHsgdGFncywgdGVybWluYWwgfSBmcm9tICdAYW5ndWxhci1kZXZraXQvY29yZSc7XG5pbXBvcnQgKiBhcyBnbG9iIGZyb20gJ2dsb2InO1xuaW1wb3J0ICdqYXNtaW5lJztcbmltcG9ydCB7IFNwZWNSZXBvcnRlciBhcyBKYXNtaW5lU3BlY1JlcG9ydGVyIH0gZnJvbSAnamFzbWluZS1zcGVjLXJlcG9ydGVyJztcbmltcG9ydCB7IGpvaW4sIHJlbGF0aXZlIH0gZnJvbSAncGF0aCc7XG5cblxuY29uc3QgSmFzbWluZSA9IHJlcXVpcmUoJ2phc21pbmUnKTtcblxuY29uc3QgcHJvamVjdEJhc2VEaXIgPSBqb2luKF9fZGlybmFtZSwgJy4uL3BhY2thZ2VzJyk7XG5yZXF1aXJlKCdzb3VyY2UtbWFwLXN1cHBvcnQnKS5pbnN0YWxsKHtcbiAgaG9va1JlcXVpcmU6IHRydWUsXG59KTtcblxuXG5kZWNsYXJlIGNvbnN0IGdsb2JhbDoge1xuICBiZW5jaG1hcmtSZXBvcnRlcjoge307XG59O1xuXG5cbmludGVyZmFjZSBCZW5jaG1hcmtSZXN1bHQge1xuICBzbG93ZXN0OiBudW1iZXJbXTtcbiAgZmFzdGVzdDogbnVtYmVyW107XG4gIG1lYW46IG51bWJlcjtcbiAgYXZlcmFnZTogbnVtYmVyO1xuXG4gIGJhc2U/OiBCZW5jaG1hcmtSZXN1bHQ7XG59XG5cblxuY2xhc3MgQmVuY2htYXJrUmVwb3J0ZXIgZXh0ZW5kcyBKYXNtaW5lU3BlY1JlcG9ydGVyIGltcGxlbWVudHMgamFzbWluZS5DdXN0b21SZXBvcnRlciB7XG4gIHByaXZhdGUgX3N0YXRzOiBCZW5jaG1hcmtSZXN1bHQgfCBudWxsO1xuXG4gIGNvbnN0cnVjdG9yKCkge1xuICAgIHN1cGVyKHtcbiAgICAgIHN1bW1hcnk6IHt9LFxuICAgIH0pO1xuICB9XG5cbiAgcmVwb3J0QmVuY2htYXJrKHN0YXRzOiBCZW5jaG1hcmtSZXN1bHQpIHtcbiAgICB0aGlzLl9zdGF0cyA9IHN0YXRzO1xuICB9XG5cbiAgamFzbWluZVN0YXJ0ZWQoc3VpdGVJbmZvOiBqYXNtaW5lLlN1aXRlSW5mbyk6IHZvaWQge1xuICAgIHN1cGVyLmphc21pbmVTdGFydGVkKHN1aXRlSW5mbyk7XG4gIH1cbiAgc3VpdGVTdGFydGVkKHJlc3VsdDogamFzbWluZS5DdXN0b21SZXBvcnRlclJlc3VsdCk6IHZvaWQge1xuICAgIHN1cGVyLnN1aXRlU3RhcnRlZChyZXN1bHQpO1xuICB9XG4gIHNwZWNTdGFydGVkKHJlc3VsdDogamFzbWluZS5DdXN0b21SZXBvcnRlclJlc3VsdCk6IHZvaWQge1xuICAgIHN1cGVyLnNwZWNTdGFydGVkKHJlc3VsdCk7XG4gICAgdGhpcy5fc3RhdHMgPSBudWxsO1xuICB9XG4gIHNwZWNEb25lKHJlc3VsdDogamFzbWluZS5DdXN0b21SZXBvcnRlclJlc3VsdCk6IHZvaWQge1xuICAgIHN1cGVyLnNwZWNEb25lKHJlc3VsdCk7XG4gICAgaWYgKHJlc3VsdC5zdGF0dXMgPT0gJ3Bhc3NlZCcgJiYgdGhpcy5fc3RhdHMpIHtcbiAgICAgIGNvbnN0IHN0YXQgPSB0aGlzLl9zdGF0cztcbiAgICAgIGNvbnN0IHBhZGRpbmcgPSAnICAgICAgICAgICAgICc7XG5cbiAgICAgIGZ1bmN0aW9uIHBhZCh4OiBzdHJpbmcgfCBudW1iZXIsIHA6IHN0cmluZyA9IHBhZGRpbmcpOiBzdHJpbmcge1xuICAgICAgICBjb25zdCBzID0gKCcnICsgeCkucmVwbGFjZSgvXFxCKD89KFxcZHszfSkrKD8hXFxkKSkvZywgJyAnKTtcblxuICAgICAgICByZXR1cm4gcC5zdWJzdHIoMCwgcC5sZW5ndGggLSAoJycgKyBzKS5sZW5ndGgpICsgcztcbiAgICAgIH1cblxuICAgICAgY29uc3QgZmFzdGVzdCA9IHN0YXQuZmFzdGVzdC5tYXAoeCA9PiBwYWQoeCkpLmpvaW4oJycpO1xuICAgICAgY29uc3Qgc2xvd2VzdCA9IHN0YXQuc2xvd2VzdC5tYXAoeCA9PiBwYWQoeCkpLmpvaW4oJycpO1xuICAgICAgY29uc3QgbWVhbiA9IHBhZChNYXRoLmZsb29yKHN0YXQubWVhbikpO1xuICAgICAgY29uc3QgYXZlcmFnZSA9IHBhZChNYXRoLmZsb29yKHN0YXQuYXZlcmFnZSkpO1xuICAgICAgaWYgKHN0YXQuYmFzZSkge1xuICAgICAgICBjb25zdCBwcmVjaXNpb24gPSAoeDogbnVtYmVyKSA9PiAoJycgKyBNYXRoLmZsb29yKHggKiAxMDApKS5yZXBsYWNlKC8oXFxkXFxkKSQvLCAnLiQxJyk7XG4gICAgICAgIGNvbnN0IG11bHRQYWQgPSAnICAgICAgJztcbiAgICAgICAgY29uc3QgYmFzZUZhc3Rlc3QgPSBzdGF0LmJhc2UuZmFzdGVzdC5tYXAoeCA9PiBwYWQoeCkpLmpvaW4oJycpO1xuICAgICAgICBjb25zdCBiYXNlU2xvd2VzdCA9IHN0YXQuYmFzZS5zbG93ZXN0Lm1hcCh4ID0+IHBhZCh4KSkuam9pbignJyk7XG4gICAgICAgIGNvbnN0IGJhc2VNZWFuID0gcGFkKE1hdGguZmxvb3Ioc3RhdC5iYXNlLm1lYW4pKTtcbiAgICAgICAgY29uc3QgYmFzZU1lYW5NdWx0ID0gcGFkKHByZWNpc2lvbihzdGF0Lm1lYW4gLyBzdGF0LmJhc2UubWVhbiksIG11bHRQYWQpO1xuICAgICAgICBjb25zdCBiYXNlQXZlcmFnZSA9IHBhZChNYXRoLmZsb29yKHN0YXQuYmFzZS5hdmVyYWdlKSk7XG4gICAgICAgIGNvbnN0IGJhc2VBdmVyYWdlTXVsdCA9IHBhZChwcmVjaXNpb24oc3RhdC5hdmVyYWdlIC8gc3RhdC5iYXNlLmF2ZXJhZ2UpLCBtdWx0UGFkKTtcblxuICAgICAgICBjb25zb2xlLmxvZyh0ZXJtaW5hbC5jb2xvcnMueWVsbG93KHRhZ3MuaW5kZW50QnkoNilgXG4gICAgICAgICAgZmFzdGVzdDogJHtmYXN0ZXN0fVxuICAgICAgICAgICAgKGJhc2UpICR7YmFzZUZhc3Rlc3R9XG4gICAgICAgICAgc2xvd2VzdDogJHtzbG93ZXN0fVxuICAgICAgICAgICAgKGJhc2UpICR7YmFzZVNsb3dlc3R9XG4gICAgICAgICAgbWVhbjogICAgJHttZWFufSAoJHtiYXNlTWVhbn0pICgke2Jhc2VNZWFuTXVsdH14KVxuICAgICAgICAgIGF2ZXJhZ2U6ICR7YXZlcmFnZX0gKCR7YmFzZUF2ZXJhZ2V9KSAoJHtiYXNlQXZlcmFnZU11bHR9eClcbiAgICAgICAgYCkpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgY29uc29sZS5sb2codGVybWluYWwuY29sb3JzLnllbGxvdyh0YWdzLmluZGVudEJ5KDYpYFxuICAgICAgICAgIGZhc3Rlc3Q6ICR7ZmFzdGVzdH1cbiAgICAgICAgICBzbG93ZXN0OiAke3Nsb3dlc3R9XG4gICAgICAgICAgbWVhbjogICAgJHttZWFufVxuICAgICAgICAgIGF2ZXJhZ2U6ICR7YXZlcmFnZX1cbiAgICAgICAgYCkpO1xuICAgICAgfVxuICAgIH1cbiAgfVxuICBzdWl0ZURvbmUocmVzdWx0OiBqYXNtaW5lLkN1c3RvbVJlcG9ydGVyUmVzdWx0KTogdm9pZCB7XG4gICAgc3VwZXIuc3VpdGVEb25lKHJlc3VsdCk7XG4gIH1cbiAgamFzbWluZURvbmUocnVuRGV0YWlsczogamFzbWluZS5SdW5EZXRhaWxzKTogdm9pZCB7XG4gICAgc3VwZXIuamFzbWluZURvbmUocnVuRGV0YWlscyk7XG4gIH1cbn1cblxuXG4vLyBDcmVhdGUgYSBKYXNtaW5lIHJ1bm5lciBhbmQgY29uZmlndXJlIGl0LlxuY29uc3QgcnVubmVyID0gbmV3IEphc21pbmUoeyBwcm9qZWN0QmFzZURpcjogcHJvamVjdEJhc2VEaXIgfSk7XG5cbnJ1bm5lci5lbnYuY2xlYXJSZXBvcnRlcnMoKTtcbmdsb2JhbC5iZW5jaG1hcmtSZXBvcnRlciA9IG5ldyBCZW5jaG1hcmtSZXBvcnRlcigpO1xucnVubmVyLmVudi5hZGRSZXBvcnRlcihnbG9iYWwuYmVuY2htYXJrUmVwb3J0ZXIpO1xuXG5cbi8vIE1hbnVhbGx5IHNldCBleGl0IGNvZGUgKG5lZWRlZCB3aXRoIGN1c3RvbSByZXBvcnRlcnMpXG5ydW5uZXIub25Db21wbGV0ZSgoc3VjY2VzczogYm9vbGVhbikgPT4ge1xuICBwcm9jZXNzLmV4aXRDb2RlID0gc3VjY2VzcyA/IDAgOiAxO1xufSk7XG5cblxuLy8gUnVuIHRoZSB0ZXN0cy5cbmNvbnN0IGFsbFRlc3RzID1cbiAgZ2xvYi5zeW5jKCdwYWNrYWdlcy8qKi8qX2JlbmNobWFyay50cycpXG4gICAgLm1hcChwID0+IHJlbGF0aXZlKHByb2plY3RCYXNlRGlyLCBwKSlcbiAgICAuZmlsdGVyKHAgPT4gIS9zY2hlbWF0aWNzX2NsaVxcL3NjaGVtYXRpY3NcXC8vLnRlc3QocCkpO1xuXG5cbmV4cG9ydCBkZWZhdWx0IGZ1bmN0aW9uKF9hcmdzOiB7fSkge1xuICBydW5uZXIuZXhlY3V0ZShhbGxUZXN0cyk7XG59XG4iXX0=