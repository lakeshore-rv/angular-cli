"use strict";
/**
 * @license
 * Copyright Google Inc. All Rights Reserved.
 *
 * Use of this source code is governed by an MIT-style license that can be
 * found in the LICENSE file at https://angular.io/license
 */
Object.defineProperty(exports, "__esModule", { value: true });
const core_1 = require("@angular-devkit/core");
const node_1 = require("@angular-devkit/core/node");
const operators_1 = require("rxjs/operators");
const architect_1 = require("./architect");
describe('Architect', () => {
    const host = new node_1.NodeJsSyncHost();
    const root = core_1.normalize(__dirname);
    const workspace = new core_1.experimental.workspace.Workspace(root, host);
    let architect;
    const workspaceJson = {
        version: 1,
        newProjectRoot: 'src',
        projects: {
            app: {
                root: 'app',
                sourceRoot: 'app/src',
                projectType: 'application',
                architect: {
                    browser: {
                        builder: '../test:browser',
                        options: {
                            browserOption: 1,
                        },
                        configurations: {
                            prod: {
                                optionalBrowserOption: false,
                            },
                        },
                    },
                    badBrowser: {
                        builder: '../test:browser',
                        options: {
                            badBrowserOption: 1,
                        },
                    },
                    karma: {
                        builder: '../test:karma',
                        options: {},
                    },
                },
            },
        },
    };
    beforeAll((done) => workspace.loadWorkspaceFromJson(workspaceJson).pipe(operators_1.concatMap(ws => new architect_1.Architect(ws).loadArchitect()), operators_1.tap(arch => architect = arch)).toPromise().then(done, done.fail));
    it('works', () => {
        const targetSpec = { project: 'app', target: 'browser', configuration: 'prod' };
        const builderConfig = architect.getBuilderConfiguration(targetSpec);
        expect(builderConfig.root).toBe('app');
        expect(builderConfig.sourceRoot).toBe('app/src');
        expect(builderConfig.projectType).toBe('application');
        expect(builderConfig.builder).toBe('../test:browser');
        expect(builderConfig.options.browserOption).toBe(1);
        expect(builderConfig.options.optionalBrowserOption).toBe(false);
    });
    it('lists targets by name', () => {
        expect(architect.listProjectTargets('app')).toEqual(['browser', 'badBrowser', 'karma']);
    });
    it('errors when missing target is used', () => {
        const targetSpec = { project: 'app', target: 'missing', configuration: 'prod' };
        expect(() => architect.getBuilderConfiguration(targetSpec))
            .toThrow(new architect_1.TargetNotFoundException(targetSpec.project, targetSpec.target));
    });
    it('throws when missing configuration is used', () => {
        const targetSpec = { project: 'app', target: 'browser', configuration: 'missing' };
        expect(() => architect.getBuilderConfiguration(targetSpec))
            .toThrow(new architect_1.ConfigurationNotFoundException(targetSpec.project, targetSpec.configuration));
    });
    it('runs targets', (done) => {
        const targetSpec = { project: 'app', target: 'browser', configuration: 'prod' };
        const builderConfig = architect.getBuilderConfiguration(targetSpec);
        architect.run(builderConfig).pipe(operators_1.toArray(), operators_1.tap(events => {
            expect(events.length).toBe(3);
            expect(events[0].success).toBe(true);
            expect(events[1].success).toBe(false);
            expect(events[2].success).toBe(true);
        })).toPromise().then(done, done.fail);
    });
    it('errors when builder cannot be resolved', (done) => {
        const targetSpec = { project: 'app', target: 'karma' };
        const builderConfig = architect.getBuilderConfiguration(targetSpec);
        architect.run(builderConfig).toPromise().then(() => done.fail(), (err) => {
            expect(err).toEqual(jasmine.any(architect_1.BuilderCannotBeResolvedException));
            done();
        });
    });
    it('errors when builder options fail validation', (done) => {
        const targetSpec = { project: 'app', target: 'badBrowser' };
        const builderConfig = architect.getBuilderConfiguration(targetSpec);
        architect.run(builderConfig).toPromise().then(() => done.fail(), (err) => {
            expect(err).toEqual(jasmine.any(core_1.schema.SchemaValidationException));
            done();
        });
    });
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYXJjaGl0ZWN0X3NwZWMuanMiLCJzb3VyY2VSb290IjoiL1VzZXJzL2VybmllZGF2aXMvQ29kZS9hbmd1bGFyLWNsaS8iLCJzb3VyY2VzIjpbInBhY2thZ2VzL2FuZ3VsYXJfZGV2a2l0L2FyY2hpdGVjdC9zcmMvYXJjaGl0ZWN0X3NwZWMudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IjtBQUFBOzs7Ozs7R0FNRzs7QUFFSCwrQ0FBNkU7QUFDN0Usb0RBQTJEO0FBQzNELDhDQUF5RDtBQUV6RCwyQ0FLcUI7QUFHckIsUUFBUSxDQUFDLFdBQVcsRUFBRSxHQUFHLEVBQUU7SUFDekIsTUFBTSxJQUFJLEdBQUcsSUFBSSxxQkFBYyxFQUFFLENBQUM7SUFDbEMsTUFBTSxJQUFJLEdBQUcsZ0JBQVMsQ0FBQyxTQUFTLENBQUMsQ0FBQztJQUNsQyxNQUFNLFNBQVMsR0FBRyxJQUFJLG1CQUFZLENBQUMsU0FBUyxDQUFDLFNBQVMsQ0FBQyxJQUFJLEVBQUUsSUFBSSxDQUFDLENBQUM7SUFDbkUsSUFBSSxTQUFvQixDQUFDO0lBQ3pCLE1BQU0sYUFBYSxHQUFHO1FBQ3BCLE9BQU8sRUFBRSxDQUFDO1FBQ1YsY0FBYyxFQUFFLEtBQUs7UUFDckIsUUFBUSxFQUFFO1lBQ1IsR0FBRyxFQUFFO2dCQUNILElBQUksRUFBRSxLQUFLO2dCQUNYLFVBQVUsRUFBRSxTQUFTO2dCQUNyQixXQUFXLEVBQUUsYUFBYTtnQkFDMUIsU0FBUyxFQUFFO29CQUNULE9BQU8sRUFBRTt3QkFDUCxPQUFPLEVBQUUsaUJBQWlCO3dCQUMxQixPQUFPLEVBQUU7NEJBQ1AsYUFBYSxFQUFFLENBQUM7eUJBQ2pCO3dCQUNELGNBQWMsRUFBRTs0QkFDZCxJQUFJLEVBQUU7Z0NBQ0oscUJBQXFCLEVBQUUsS0FBSzs2QkFDN0I7eUJBQ0Y7cUJBQ0Y7b0JBQ0QsVUFBVSxFQUFFO3dCQUNWLE9BQU8sRUFBRSxpQkFBaUI7d0JBQzFCLE9BQU8sRUFBRTs0QkFDUCxnQkFBZ0IsRUFBRSxDQUFDO3lCQUNwQjtx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QUFhLENBQUMsQ0FBQyxTQUFTLEVBQUUsQ0FBQyxJQUFJLENBQUMsR0FBRyxFQUFFLENBQUMsSUFBSSxDQUFDLElBQUksRUFBRSxFQUFFLENBQUMsR0FBVSxFQUFFLEVBQUU7WUFDOUUsTUFBTSxDQUFDLEdBQUcsQ0FBQyxDQUFDLE9BQU8sQ0FBQyxPQUFPLENBQUMsR0FBRyxDQUFDLDRDQUFnQyxDQUFDLENBQUMsQ0FBQztZQUNuRSxJQUFJLEVBQUUsQ0FBQztRQUNULENBQUMsQ0FBQyxDQUFDO0lBQ0wsQ0FBQyxDQUFDLENBQUM7SUFFSCxFQUFFLENBQUMsNkNBQTZDLEVBQUUsQ0FBQyxJQUFJLEVBQUUsRUFBRTtRQUN6RCxNQUFNLFVBQVUsR0FBRyxFQUFFLE9BQU8sRUFBRSxLQUFLLEVBQUUsTUFBTSxFQUFFLFlBQVksRUFBRSxDQUFDO1FBQzVELE1BQU0sYUFBYSxHQUFHLFNBQVMsQ0FBQyx1QkFBdUIsQ0FBdUIsVUFBVSxDQUFDLENBQUM7UUFDMUYsU0FBUyxDQUFDLEdBQUcsQ0FBQyxhQUFhLENBQUMsQ0FBQyxTQUFTLEVBQUUsQ0FBQyxJQUFJLENBQUMsR0FBRyxFQUFFLENBQUMsSUFBSSxDQUFDLElBQUksRUFBRSxFQUFFLENBQUMsR0FBVSxFQUFFLEVBQUU7WUFDOUUsTUFBTSxDQUFDLEdBQUcsQ0FBQyxDQUFDLE9BQU8sQ0FBQyxPQUFPLENBQUMsR0FBRyxDQUFDLGFBQU0sQ0FBQyx5QkFBeUIsQ0FBQyxDQUFDLENBQUM7WUFDbkUsSUFBSSxFQUFFLENBQUM7UUFDVCxDQUFDLENBQUMsQ0FBQztJQUNMLENBQUMsQ0FBQyxDQUFDO0FBQ0wsQ0FBQyxDQUFDLENBQUMiLCJzb3VyY2VzQ29udGVudCI6WyIvKipcbiAqIEBsaWNlbnNlXG4gKiBDb3B5cmlnaHQgR29vZ2xlIEluYy4gQWxsIFJpZ2h0cyBSZXNlcnZlZC5cbiAqXG4gKiBVc2Ugb2YgdGhpcyBzb3VyY2UgY29kZSBpcyBnb3Zlcm5lZCBieSBhbiBNSVQtc3R5bGUgbGljZW5zZSB0aGF0IGNhbiBiZVxuICogZm91bmQgaW4gdGhlIExJQ0VOU0UgZmlsZSBhdCBodHRwczovL2FuZ3VsYXIuaW8vbGljZW5zZVxuICovXG5cbmltcG9ydCB7IFBhdGgsIGV4cGVyaW1lbnRhbCwgbm9ybWFsaXplLCBzY2hlbWEgfSBmcm9tICdAYW5ndWxhci1kZXZraXQvY29yZSc7XG5pbXBvcnQgeyBOb2RlSnNTeW5jSG9zdCB9IGZyb20gJ0Bhbmd1bGFyLWRldmtpdC9jb3JlL25vZGUnO1xuaW1wb3J0IHsgY29uY2F0TWFwLCB0YXAsIHRvQXJyYXkgfSBmcm9tICdyeGpzL29wZXJhdG9ycyc7XG5pbXBvcnQgeyBCcm93c2VyVGFyZ2V0T3B0aW9ucyB9IGZyb20gJy4uL3Rlc3QvYnJvd3Nlcic7XG5pbXBvcnQge1xuICBBcmNoaXRlY3QsXG4gIEJ1aWxkZXJDYW5ub3RCZVJlc29sdmVkRXhjZXB0aW9uLFxuICBDb25maWd1cmF0aW9uTm90Rm91bmRFeGNlcHRpb24sXG4gIFRhcmdldE5vdEZvdW5kRXhjZXB0aW9uLFxufSBmcm9tICcuL2FyY2hpdGVjdCc7XG5cblxuZGVzY3JpYmUoJ0FyY2hpdGVjdCcsICgpID0+IHtcbiAgY29uc3QgaG9zdCA9IG5ldyBOb2RlSnNTeW5jSG9zdCgpO1xuICBjb25zdCByb290ID0gbm9ybWFsaXplKF9fZGlybmFtZSk7XG4gIGNvbnN0IHdvcmtzcGFjZSA9IG5ldyBleHBlcmltZW50YWwud29ya3NwYWNlLldvcmtzcGFjZShyb290LCBob3N0KTtcbiAgbGV0IGFyY2hpdGVjdDogQXJjaGl0ZWN0O1xuICBjb25zdCB3b3Jrc3BhY2VKc29uID0ge1xuICAgIHZlcnNpb246IDEsXG4gICAgbmV3UHJvamVjdFJvb3Q6ICdzcmMnLFxuICAgIHByb2plY3RzOiB7XG4gICAgICBhcHA6IHtcbiAgICAgICAgcm9vdDogJ2FwcCcsXG4gICAgICAgIHNvdXJjZVJvb3Q6ICdhcHAvc3JjJyxcbiAgICAgICAgcHJvamVjdFR5cGU6ICdhcHBsaWNhdGlvbicsXG4gICAgICAgIGFyY2hpdGVjdDoge1xuICAgICAgICAgIGJyb3dzZXI6IHtcbiAgICAgICAgICAgIGJ1aWxkZXI6ICcuLi90ZXN0OmJyb3dzZXInLFxuICAgICAgICAgICAgb3B0aW9uczoge1xuICAgICAgICAgICAgICBicm93c2VyT3B0aW9uOiAxLFxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGNvbmZpZ3VyYXRpb25zOiB7XG4gICAgICAgICAgICAgIHByb2Q6IHtcbiAgICAgICAgICAgICAgICBvcHRpb25hbEJyb3dzZXJPcHRpb246IGZhbHNlLFxuICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgfSxcbiAgICAgICAgICB9LFxuICAgICAgICAgIGJhZEJyb3dzZXI6IHtcbiAgICAgICAgICAgIGJ1aWxkZXI6ICcuLi90ZXN0OmJyb3dzZXInLFxuICAgICAgICAgICAgb3B0aW9uczoge1xuICAgICAgICAgICAgICBiYWRCcm93c2VyT3B0aW9uOiAxLFxuICAgICAgICAgICAgfSxcbiAgICAgICAgICB9LFxuICAgICAgICAgIGthcm1hOiB7XG4gICAgICAgICAgICBidWlsZGVyOiAnLi4vdGVzdDprYXJtYScsXG4gICAgICAgICAgICBvcHRpb25zOiB7fSxcbiAgICAgICAgICB9LFxuICAgICAgICB9LFxuICAgICAgfSxcbiAgICB9LFxuICB9O1xuXG4gIGJlZm9yZUFsbCgoZG9uZSkgPT4gd29ya3NwYWNlLmxvYWRXb3Jrc3BhY2VGcm9tSnNvbih3b3Jrc3BhY2VKc29uKS5waXBlKFxuICAgIGNvbmNhdE1hcCh3cyA9PiBuZXcgQXJjaGl0ZWN0KHdzKS5sb2FkQXJjaGl0ZWN0KCkpLFxuICAgIHRhcChhcmNoID0+IGFyY2hpdGVjdCA9IGFyY2gpLFxuICApLnRvUHJvbWlzZSgpLnRoZW4oZG9uZSwgZG9uZS5mYWlsKSk7XG5cbiAgaXQoJ3dvcmtzJywgKCkgPT4ge1xuICAgIGNvbnN0IHRhcmdldFNwZWMgPSB7IHByb2plY3Q6ICdhcHAnLCB0YXJnZXQ6ICdicm93c2VyJywgY29uZmlndXJhdGlvbjogJ3Byb2QnIH07XG4gICAgY29uc3QgYnVpbGRlckNvbmZpZyA9IGFyY2hpdGVjdC5nZXRCdWlsZGVyQ29uZmlndXJhdGlvbjxCcm93c2VyVGFyZ2V0T3B0aW9ucz4odGFyZ2V0U3BlYyk7XG4gICAgZXhwZWN0KGJ1aWxkZXJDb25maWcucm9vdCkudG9CZSgnYXBwJyk7XG4gICAgZXhwZWN0KGJ1aWxkZXJDb25maWcuc291cmNlUm9vdCkudG9CZSgnYXBwL3NyYycgYXMgUGF0aCk7XG4gICAgZXhwZWN0KGJ1aWxkZXJDb25maWcucHJvamVjdFR5cGUpLnRvQmUoJ2FwcGxpY2F0aW9uJyk7XG4gICAgZXhwZWN0KGJ1aWxkZXJDb25maWcuYnVpbGRlcikudG9CZSgnLi4vdGVzdDpicm93c2VyJyk7XG4gICAgZXhwZWN0KGJ1aWxkZXJDb25maWcub3B0aW9ucy5icm93c2VyT3B0aW9uKS50b0JlKDEpO1xuICAgIGV4cGVjdChidWlsZGVyQ29uZmlnLm9wdGlvbnMub3B0aW9uYWxCcm93c2VyT3B0aW9uKS50b0JlKGZhbHNlKTtcbiAgfSk7XG5cbiAgaXQoJ2xpc3RzIHRhcmdldHMgYnkgbmFtZScsICgpID0+IHtcbiAgICBleHBlY3QoYXJjaGl0ZWN0Lmxpc3RQcm9qZWN0VGFyZ2V0cygnYXBwJykpLnRvRXF1YWwoWydicm93c2VyJywgJ2JhZEJyb3dzZXInLCAna2FybWEnXSk7XG4gIH0pO1xuXG4gIGl0KCdlcnJvcnMgd2hlbiBtaXNzaW5nIHRhcmdldCBpcyB1c2VkJywgKCkgPT4ge1xuICAgIGNvbnN0IHRhcmdldFNwZWMgPSB7IHByb2plY3Q6ICdhcHAnLCB0YXJnZXQ6ICdtaXNzaW5nJywgY29uZmlndXJhdGlvbjogJ3Byb2QnIH07XG4gICAgZXhwZWN0KCgpID0+IGFyY2hpdGVjdC5nZXRCdWlsZGVyQ29uZmlndXJhdGlvbjxCcm93c2VyVGFyZ2V0T3B0aW9ucz4odGFyZ2V0U3BlYykpXG4gICAgICAudG9UaHJvdyhuZXcgVGFyZ2V0Tm90Rm91bmRFeGNlcHRpb24odGFyZ2V0U3BlYy5wcm9qZWN0LCB0YXJnZXRTcGVjLnRhcmdldCkpO1xuICB9KTtcblxuICBpdCgndGhyb3dzIHdoZW4gbWlzc2luZyBjb25maWd1cmF0aW9uIGlzIHVzZWQnLCAoKSA9PiB7XG4gICAgY29uc3QgdGFyZ2V0U3BlYyA9IHsgcHJvamVjdDogJ2FwcCcsIHRhcmdldDogJ2Jyb3dzZXInLCBjb25maWd1cmF0aW9uOiAnbWlzc2luZycgfTtcbiAgICBleHBlY3QoKCkgPT4gYXJjaGl0ZWN0LmdldEJ1aWxkZXJDb25maWd1cmF0aW9uPEJyb3dzZXJUYXJnZXRPcHRpb25zPih0YXJnZXRTcGVjKSlcbiAgICAgIC50b1Rocm93KG5ldyBDb25maWd1cmF0aW9uTm90Rm91bmRFeGNlcHRpb24odGFyZ2V0U3BlYy5wcm9qZWN0LCB0YXJnZXRTcGVjLmNvbmZpZ3VyYXRpb24pKTtcbiAgfSk7XG5cbiAgaXQoJ3J1bnMgdGFyZ2V0cycsIChkb25lKSA9PiB7XG4gICAgY29uc3QgdGFyZ2V0U3BlYyA9IHsgcHJvamVjdDogJ2FwcCcsIHRhcmdldDogJ2Jyb3dzZXInLCBjb25maWd1cmF0aW9uOiAncHJvZCcgfTtcbiAgICBjb25zdCBidWlsZGVyQ29uZmlnID0gYXJjaGl0ZWN0LmdldEJ1aWxkZXJDb25maWd1cmF0aW9uPEJyb3dzZXJUYXJnZXRPcHRpb25zPih0YXJnZXRTcGVjKTtcbiAgICBhcmNoaXRlY3QucnVuKGJ1aWxkZXJDb25maWcpLnBpcGUoXG4gICAgICB0b0FycmF5KCksXG4gICAgICB0YXAoZXZlbnRzID0+IHtcbiAgICAgICAgZXhwZWN0KGV2ZW50cy5sZW5ndGgpLnRvQmUoMyk7XG4gICAgICAgIGV4cGVjdChldmVudHNbMF0uc3VjY2VzcykudG9CZSh0cnVlKTtcbiAgICAgICAgZXhwZWN0KGV2ZW50c1sxXS5zdWNjZXNzKS50b0JlKGZhbHNlKTtcbiAgICAgICAgZXhwZWN0KGV2ZW50c1syXS5zdWNjZXNzKS50b0JlKHRydWUpO1xuICAgICAgfSksXG4gICAgKS50b1Byb21pc2UoKS50aGVuKGRvbmUsIGRvbmUuZmFpbCk7XG4gIH0pO1xuXG4gIGl0KCdlcnJvcnMgd2hlbiBidWlsZGVyIGNhbm5vdCBiZSByZXNvbHZlZCcsIChkb25lKSA9PiB7XG4gICAgY29uc3QgdGFyZ2V0U3BlYyA9IHsgcHJvamVjdDogJ2FwcCcsIHRhcmdldDogJ2thcm1hJyB9O1xuICAgIGNvbnN0IGJ1aWxkZXJDb25maWcgPSBhcmNoaXRlY3QuZ2V0QnVpbGRlckNvbmZpZ3VyYXRpb248QnJvd3NlclRhcmdldE9wdGlvbnM+KHRhcmdldFNwZWMpO1xuICAgIGFyY2hpdGVjdC5ydW4oYnVpbGRlckNvbmZpZykudG9Qcm9taXNlKCkudGhlbigoKSA9PiBkb25lLmZhaWwoKSwgKGVycjogRXJyb3IpID0+IHtcbiAgICAgIGV4cGVjdChlcnIpLnRvRXF1YWwoamFzbWluZS5hbnkoQnVpbGRlckNhbm5vdEJlUmVzb2x2ZWRFeGNlcHRpb24pKTtcbiAgICAgIGRvbmUoKTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgaXQoJ2Vycm9ycyB3aGVuIGJ1aWxkZXIgb3B0aW9ucyBmYWlsIHZhbGlkYXRpb24nLCAoZG9uZSkgPT4ge1xuICAgIGNvbnN0IHRhcmdldFNwZWMgPSB7IHByb2plY3Q6ICdhcHAnLCB0YXJnZXQ6ICdiYWRCcm93c2VyJyB9O1xuICAgIGNvbnN0IGJ1aWxkZXJDb25maWcgPSBhcmNoaXRlY3QuZ2V0QnVpbGRlckNvbmZpZ3VyYXRpb248QnJvd3NlclRhcmdldE9wdGlvbnM+KHRhcmdldFNwZWMpO1xuICAgIGFyY2hpdGVjdC5ydW4oYnVpbGRlckNvbmZpZykudG9Qcm9taXNlKCkudGhlbigoKSA9PiBkb25lLmZhaWwoKSwgKGVycjogRXJyb3IpID0+IHtcbiAgICAgIGV4cGVjdChlcnIpLnRvRXF1YWwoamFzbWluZS5hbnkoc2NoZW1hLlNjaGVtYVZhbGlkYXRpb25FeGNlcHRpb24pKTtcbiAgICAgIGRvbmUoKTtcbiAgICB9KTtcbiAgfSk7XG59KTtcbiJdfQ==