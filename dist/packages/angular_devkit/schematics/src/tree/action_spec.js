"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
/**
 * @license
 * Copyright Google Inc. All Rights Reserved.
 *
 * Use of this source code is governed by an MIT-style license that can be
 * found in the LICENSE file at https://angular.io/license
 */
const core_1 = require("@angular-devkit/core");
const action_1 = require("./action");
describe('Action', () => {
    describe('optimize', () => {
        it('works with create', () => {
            const actions = new action_1.ActionList;
            actions.create(core_1.normalize('/a/b'), Buffer.from('1'));
            actions.create(core_1.normalize('/a/c'), Buffer.from('2'));
            actions.create(core_1.normalize('/a/c'), Buffer.from('3'));
            expect(actions.length).toBe(3);
            actions.optimize();
            expect(actions.length).toBe(2);
        });
        it('works with overwrite', () => {
            const actions = new action_1.ActionList;
            actions.create(core_1.normalize('/a/b'), Buffer.from('1'));
            actions.create(core_1.normalize('/a/c'), Buffer.from('2'));
            actions.overwrite(core_1.normalize('/a/c'), Buffer.from('3'));
            actions.overwrite(core_1.normalize('/a/b'), Buffer.from('4'));
            expect(actions.length).toBe(4);
            actions.optimize();
            expect(actions.length).toBe(2);
        });
        it('works with cloning a list', () => {
            const actions = new action_1.ActionList;
            actions.create(core_1.normalize('/a/b'), Buffer.from('1'));
            actions.create(core_1.normalize('/a/c'), Buffer.from('2'));
            actions.overwrite(core_1.normalize('/a/c'), Buffer.from('3'));
            actions.overwrite(core_1.normalize('/a/b'), Buffer.from('4'));
            actions.create(core_1.normalize('/a/d'), Buffer.from('5'));
            const actions2 = new action_1.ActionList;
            actions.forEach(x => actions2.push(x));
            expect(actions.length).toBe(5);
            expect(actions2.length).toBe(5);
            actions.optimize();
            expect(actions.length).toBe(3);
            expect(actions2.length).toBe(5);
            actions2.optimize();
            expect(actions2.length).toBe(3);
        });
        it('handles edge cases (1)', () => {
            const actions = new action_1.ActionList;
            actions.create(core_1.normalize('/test'), Buffer.from('1'));
            actions.overwrite(core_1.normalize('/test'), Buffer.from('3'));
            actions.overwrite(core_1.normalize('/hello'), Buffer.from('2'));
            actions.overwrite(core_1.normalize('/test'), Buffer.from('4'));
            const actions2 = new action_1.ActionList;
            actions.forEach(x => actions2.push(x));
            expect(actions.length).toBe(4);
            expect(actions2.length).toBe(4);
            actions.optimize();
            expect(actions.length).toBe(2);
            expect(actions2.length).toBe(4);
            actions2.optimize();
            expect(actions2.length).toBe(2);
        });
        it('handles edge cases (2)', () => {
            const actions = new action_1.ActionList;
            actions.create(core_1.normalize('/test'), Buffer.from('1'));
            actions.rename(core_1.normalize('/test'), core_1.normalize('/test1'));
            actions.overwrite(core_1.normalize('/test1'), Buffer.from('2'));
            actions.rename(core_1.normalize('/test1'), core_1.normalize('/test2'));
            actions.optimize();
            expect(actions.length).toBe(1);
            expect(actions.get(0)).toEqual(jasmine.objectContaining({ kind: 'c', path: core_1.normalize('/test2') }));
        });
        it('handles edge cases (3)', () => {
            const actions = new action_1.ActionList;
            actions.rename(core_1.normalize('/test'), core_1.normalize('/test1'));
            actions.overwrite(core_1.normalize('/test1'), Buffer.from('2'));
            actions.rename(core_1.normalize('/test1'), core_1.normalize('/test2'));
            actions.optimize();
            expect(actions.length).toBe(2);
            expect(actions.get(0)).toEqual(jasmine.objectContaining({
                kind: 'r', path: core_1.normalize('/test'), to: core_1.normalize('/test2'),
            }));
            expect(actions.get(1)).toEqual(jasmine.objectContaining({ kind: 'o', path: core_1.normalize('/test2') }));
        });
    });
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYWN0aW9uX3NwZWMuanMiLCJzb3VyY2VSb290IjoiL1VzZXJzL2VybmllZGF2aXMvQ29kZS9hbmd1bGFyLWNsaS8iLCJzb3VyY2VzIjpbInBhY2thZ2VzL2FuZ3VsYXJfZGV2a2l0L3NjaGVtYXRpY3Mvc3JjL3RyZWUvYWN0aW9uX3NwZWMudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7QUFBQTs7Ozs7O0dBTUc7QUFDSCwrQ0FBaUQ7QUFDakQscUNBQThDO0FBRTlDLFFBQVEsQ0FBQyxRQUFRLEVBQUUsR0FBRyxFQUFFO0lBQ3RCLFFBQVEsQ0FBQyxVQUFVLEVBQUUsR0FBRyxFQUFFO1FBQ3hCLEVBQUUsQ0FBQyxtQkFBbUIsRUFBRSxHQUFHLEVBQUU7WUFDM0IsTUFBTSxPQUFPLEdBQUcsSUFBSSxtQkFBVSxDQUFDO1lBRS9CLE9BQU8sQ0FBQyxNQUFNLENBQUMsZ0JBQVMsQ0FBQyxNQUFNLENBQUMsRUFBRSxNQUFNLENBQUMsSUFBSSxDQUFDLEdBQUcsQ0FBQyxDQUFDLENBQUM7WUFDcEQsT0FBTyxDQUFDLE1BQU0sQ0FBQyxnQkFBUyxDQUFDLE1BQU0sQ0FBQyxFQUFFLE1BQU0sQ0FBQyxJQUFJLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBQztZQUNwRCxPQUFPLENBQUMsTUFBTSxDQUFDLGdCQUFTLENBQUMsTUFBTSxDQUFDLEVBQUUsTUFBTSxDQUFDLElBQUksQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFDO1lBRXBELE1BQU0sQ0FBQyxPQUFPLENBQUMsTUFBTSxDQUFDLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQyxDQUFDO1lBQy9CLE9BQU8sQ0FBQyxRQUFRLEVBQUUsQ0FBQztZQUNuQixNQUFNLENBQUMsT0FBTyxDQUFDLE1BQU0sQ0FBQyxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUMsQ0FBQztRQUNqQyxDQUFDLENBQUMsQ0FBQztRQUNILEVBQUUsQ0FBQyxzQkFBc0IsRUFBRSxHQUFHLEVBQUU7WUFDOUIsTUFBTSxPQUFPLEdBQUcsSUFBSSxtQkFB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UUFBUSxDQUFDLEVBQUUsZ0JBQVMsQ0FBQyxRQUFRLENBQUMsQ0FBQyxDQUFDO1lBRXpELE9BQU8sQ0FBQyxRQUFRLEVBQUUsQ0FBQztZQUNuQixNQUFNLENBQUMsT0FBTyxDQUFDLE1BQU0sQ0FBQyxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUMsQ0FBQztZQUMvQixNQUFNLENBQUMsT0FBTyxDQUFDLEdBQUcsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLE9BQU8sQ0FBQyxPQUFPLENBQUMsZ0JBQWdCLENBQVM7Z0JBQzlELElBQUksRUFBRSxHQUFHLEVBQUUsSUFBSSxFQUFFLGdCQUFTLENBQUMsT0FBTyxDQUFDLEVBQUUsRUFBRSxFQUFFLGdCQUFTLENBQUMsUUFBUSxDQUFDO2FBQzdELENBQUMsQ0FBQyxDQUFDO1lBQ0osTUFBTSxDQUFDLE9BQU8sQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxPQUFPLENBQzVCLE9BQU8sQ0FBQyxnQkFBZ0IsQ0FBUyxFQUFDLElBQUksRUFBRSxHQUFHLEVBQUUsSUFBSSxFQUFFLGdCQUFTLENBQUMsUUFBUSxDQUFDLEVBQUUsQ0FBQyxDQUMxRSxDQUFDO1FBQ0osQ0FBQyxDQUFDLENBQUM7SUFDTCxDQUFDLENBQUMsQ0FBQztBQUNMLENBQUMsQ0FBQyxDQUFDIiwic291cmNlc0NvbnRlbnQiOlsiLyoqXG4gKiBAbGljZW5zZVxuICogQ29weXJpZ2h0IEdvb2dsZSBJbmMuIEFsbCBSaWdodHMgUmVzZXJ2ZWQuXG4gKlxuICogVXNlIG9mIHRoaXMgc291cmNlIGNvZGUgaXMgZ292ZXJuZWQgYnkgYW4gTUlULXN0eWxlIGxpY2Vuc2UgdGhhdCBjYW4gYmVcbiAqIGZvdW5kIGluIHRoZSBMSUNFTlNFIGZpbGUgYXQgaHR0cHM6Ly9hbmd1bGFyLmlvL2xpY2Vuc2VcbiAqL1xuaW1wb3J0IHsgbm9ybWFsaXplIH0gZnJvbSAnQGFuZ3VsYXItZGV2a2l0L2NvcmUnO1xuaW1wb3J0IHsgQWN0aW9uLCBBY3Rpb25MaXN0IH0gZnJvbSAnLi9hY3Rpb24nO1xuXG5kZXNjcmliZSgnQWN0aW9uJywgKCkgPT4ge1xuICBkZXNjcmliZSgnb3B0aW1pemUnLCAoKSA9PiB7XG4gICAgaXQoJ3dvcmtzIHdpdGggY3JlYXRlJywgKCkgPT4ge1xuICAgICAgY29uc3QgYWN0aW9ucyA9IG5ldyBBY3Rpb25MaXN0O1xuXG4gICAgICBhY3Rpb25zLmNyZWF0ZShub3JtYWxpemUoJy9hL2InKSwgQnVmZmVyLmZyb20oJzEnKSk7XG4gICAgICBhY3Rpb25zLmNyZWF0ZShub3JtYWxpemUoJy9hL2MnKSwgQnVmZmVyLmZyb20oJzInKSk7XG4gICAgICBhY3Rpb25zLmNyZWF0ZShub3JtYWxpemUoJy9hL2MnKSwgQnVmZmVyLmZyb20oJzMnKSk7XG5cbiAgICAgIGV4cGVjdChhY3Rpb25zLmxlbmd0aCkudG9CZSgzKTtcbiAgICAgIGFjdGlvbnMub3B0aW1pemUoKTtcbiAgICAgIGV4cGVjdChhY3Rpb25zLmxlbmd0aCkudG9CZSgyKTtcbiAgICB9KTtcbiAgICBpdCgnd29ya3Mgd2l0aCBvdmVyd3JpdGUnLCAoKSA9PiB7XG4gICAgICBjb25zdCBhY3Rpb25zID0gbmV3IEFjdGlvbkxpc3Q7XG5cbiAgICAgIGFjdGlvbnMuY3JlYXRlKG5vcm1hbGl6ZSgnL2EvYicpLCBCdWZmZXIuZnJvbSgnMScpKTtcbiAgICAgIGFjdGlvbnMuY3JlYXRlKG5vcm1hbGl6ZSgnL2EvYycpLCBCdWZmZXIuZnJvbSgnMicpKTtcbiAgICAgIGFjdGlvbnMub3ZlcndyaXRlKG5vcm1hbGl6ZSgnL2EvYycpLCBCdWZmZXIuZnJvbSgnMycpKTtcbiAgICAgIGFjdGlvbnMub3ZlcndyaXRlKG5vcm1hbGl6ZSgnL2EvYicpLCBCdWZmZXIuZnJvbSgnNCcpKTtcblxuICAgICAgZXhwZWN0KGFjdGlvbnMubGVuZ3RoKS50b0JlKDQpO1xuICAgICAgYWN0aW9ucy5vcHRpbWl6ZSgpO1xuICAgICAgZXhwZWN0KGFjdGlvbnMubGVuZ3RoKS50b0JlKDIpO1xuICAgIH0pO1xuXG4gICAgaXQoJ3dvcmtzIHdpdGggY2xvbmluZyBhIGxpc3QnLCAoKSA9PiB7XG4gICAgICBjb25zdCBhY3Rpb25zID0gbmV3IEFjdGlvbkxpc3Q7XG5cbiAgICAgIGFjdGlvbnMuY3JlYXRlKG5vcm1hbGl6ZSgnL2EvYicpLCBCdWZmZXIuZnJvbSgnMScpKTtcbiAgICAgIGFjdGlvbnMuY3JlYXRlKG5vcm1hbGl6ZSgnL2EvYycpLCBCdWZmZXIuZnJvbSgnMicpKTtcbiAgICAgIGFjdGlvbnMub3ZlcndyaXRlKG5vcm1hbGl6ZSgnL2EvYycpLCBCdWZmZXIuZnJvbSgnMycpKTtcbiAgICAgIGFjdGlvbnMub3ZlcndyaXRlKG5vcm1hbGl6ZSgnL2EvYicpLCBCdWZmZXIuZnJvbSgnNCcpKTtcbiAgICAgIGFjdGlvbnMuY3JlYXRlKG5vcm1hbGl6ZSgnL2EvZCcpLCBCdWZmZXIuZnJvbSgnNScpKTtcblxuICAgICAgY29uc3QgYWN0aW9uczIgPSBuZXcgQWN0aW9uTGlzdDtcbiAgICAgIGFjdGlvbnMuZm9yRWFjaCh4ID0+IGFjdGlvbnMyLnB1c2goeCkpO1xuXG4gICAgICBleHBlY3QoYWN0aW9ucy5sZW5ndGgpLnRvQmUoNSk7XG4gICAgICBleHBlY3QoYWN0aW9uczIubGVuZ3RoKS50b0JlKDUpO1xuICAgICAgYWN0aW9ucy5vcHRpbWl6ZSgpO1xuICAgICAgZXhwZWN0KGFjdGlvbnMubGVuZ3RoKS50b0JlKDMpO1xuICAgICAgZXhwZWN0KGFjdGlvbnMyLmxlbmd0aCkudG9CZSg1KTtcbiAgICAgIGFjdGlvbnMyLm9wdGltaXplKCk7XG4gICAgICBleHBlY3QoYWN0aW9uczIubGVuZ3RoKS50b0JlKDMpO1xuICAgIH0pO1xuXG4gICAgaXQoJ2hhbmRsZXMgZWRnZSBjYXNlcyAoMSknLCAoKSA9PiB7XG4gICAgICBjb25zdCBhY3Rpb25zID0gbmV3IEFjdGlvbkxpc3Q7XG5cbiAgICAgIGFjdGlvbnMuY3JlYXRlKG5vcm1hbGl6ZSgnL3Rlc3QnKSwgQnVmZmVyLmZyb20oJzEnKSk7XG4gICAgICBhY3Rpb25zLm92ZXJ3cml0ZShub3JtYWxpemUoJy90ZXN0JyksIEJ1ZmZlci5mcm9tKCczJykpO1xuICAgICAgYWN0aW9ucy5vdmVyd3JpdGUobm9ybWFsaXplKCcvaGVsbG8nKSwgQnVmZmVyLmZyb20oJzInKSk7XG4gICAgICBhY3Rpb25zLm92ZXJ3cml0ZShub3JtYWxpemUoJy90ZXN0JyksIEJ1ZmZlci5mcm9tKCc0JykpO1xuXG4gICAgICBjb25zdCBhY3Rpb25zMiA9IG5ldyBBY3Rpb25MaXN0O1xuICAgICAgYWN0aW9ucy5mb3JFYWNoKHggPT4gYWN0aW9uczIucHVzaCh4KSk7XG5cbiAgICAgIGV4cGVjdChhY3Rpb25zLmxlbmd0aCkudG9CZSg0KTtcbiAgICAgIGV4cGVjdChhY3Rpb25zMi5sZW5ndGgpLnRvQmUoNCk7XG4gICAgICBhY3Rpb25zLm9wdGltaXplKCk7XG4gICAgICBleHBlY3QoYWN0aW9ucy5sZW5ndGgpLnRvQmUoMik7XG4gICAgICBleHBlY3QoYWN0aW9uczIubGVuZ3RoKS50b0JlKDQpO1xuICAgICAgYWN0aW9uczIub3B0aW1pemUoKTtcbiAgICAgIGV4cGVjdChhY3Rpb25zMi5sZW5ndGgpLnRvQmUoMik7XG4gICAgfSk7XG5cbiAgICBpdCgnaGFuZGxlcyBlZGdlIGNhc2VzICgyKScsICgpID0+IHtcbiAgICAgIGNvbnN0IGFjdGlvbnMgPSBuZXcgQWN0aW9uTGlzdDtcblxuICAgICAgYWN0aW9ucy5jcmVhdGUobm9ybWFsaXplKCcvdGVzdCcpLCBCdWZmZXIuZnJvbSgnMScpKTtcbiAgICAgIGFjdGlvbnMucmVuYW1lKG5vcm1hbGl6ZSgnL3Rlc3QnKSwgbm9ybWFsaXplKCcvdGVzdDEnKSk7XG4gICAgICBhY3Rpb25zLm92ZXJ3cml0ZShub3JtYWxpemUoJy90ZXN0MScpLCBCdWZmZXIuZnJvbSgnMicpKTtcbiAgICAgIGFjdGlvbnMucmVuYW1lKG5vcm1hbGl6ZSgnL3Rlc3QxJyksIG5vcm1hbGl6ZSgnL3Rlc3QyJykpO1xuXG4gICAgICBhY3Rpb25zLm9wdGltaXplKCk7XG4gICAgICBleHBlY3QoYWN0aW9ucy5sZW5ndGgpLnRvQmUoMSk7XG4gICAgICBleHBlY3QoYWN0aW9ucy5nZXQoMCkpLnRvRXF1YWwoXG4gICAgICAgIGphc21pbmUub2JqZWN0Q29udGFpbmluZzxBY3Rpb24+KHsga2luZDogJ2MnLCBwYXRoOiBub3JtYWxpemUoJy90ZXN0MicpIH0pLFxuICAgICAgKTtcbiAgICB9KTtcblxuICAgIGl0KCdoYW5kbGVzIGVkZ2UgY2FzZXMgKDMpJywgKCkgPT4ge1xuICAgICAgY29uc3QgYWN0aW9ucyA9IG5ldyBBY3Rpb25MaXN0O1xuXG4gICAgICBhY3Rpb25zLnJlbmFtZShub3JtYWxpemUoJy90ZXN0JyksIG5vcm1hbGl6ZSgnL3Rlc3QxJykpO1xuICAgICAgYWN0aW9ucy5vdmVyd3JpdGUobm9ybWFsaXplKCcvdGVzdDEnKSwgQnVmZmVyLmZyb20oJzInKSk7XG4gICAgICBhY3Rpb25zLnJlbmFtZShub3JtYWxpemUoJy90ZXN0MScpLCBub3JtYWxpemUoJy90ZXN0MicpKTtcblxuICAgICAgYWN0aW9ucy5vcHRpbWl6ZSgpO1xuICAgICAgZXhwZWN0KGFjdGlvbnMubGVuZ3RoKS50b0JlKDIpO1xuICAgICAgZXhwZWN0KGFjdGlvbnMuZ2V0KDApKS50b0VxdWFsKGphc21pbmUub2JqZWN0Q29udGFpbmluZzxBY3Rpb24+KHtcbiAgICAgICAga2luZDogJ3InLCBwYXRoOiBub3JtYWxpemUoJy90ZXN0JyksIHRvOiBub3JtYWxpemUoJy90ZXN0MicpLFxuICAgICAgfSkpO1xuICAgICAgZXhwZWN0KGFjdGlvbnMuZ2V0KDEpKS50b0VxdWFsKFxuICAgICAgICBqYXNtaW5lLm9iamVjdENvbnRhaW5pbmc8QWN0aW9uPih7a2luZDogJ28nLCBwYXRoOiBub3JtYWxpemUoJy90ZXN0MicpIH0pLFxuICAgICAgKTtcbiAgICB9KTtcbiAgfSk7XG59KTtcbiJdfQ==