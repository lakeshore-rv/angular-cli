"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
/**
 * @license
 * Copyright Google Inc. All Rights Reserved.
 *
 * Use of this source code is governed by an MIT-style license that can be
 * found in the LICENSE file at https://angular.io/license
 */
// tslint:disable:no-any
const core_1 = require("@angular-devkit/core");
const host_tree_1 = require("./host-tree");
const virtual_1 = require("./virtual");
describe('HostTree', () => {
    it('is backward compatible with VirtualTree', () => {
        const fs = new core_1.virtualFs.test.TestHost({
            '/file1': '',
        });
        const tree = new host_tree_1.HostTree(fs);
        const vTree = new virtual_1.VirtualTree();
        tree.create('/file2', '');
        vTree.create('/file3', '');
        // This is the behaviour of 6.0.x merge (returning the branch).
        // We need to be compatible with it.
        const tree2 = tree.branch();
        tree2.merge(vTree);
        const actions = tree2.actions;
        expect(actions).toEqual([
            jasmine.objectContaining({ kind: 'c', path: core_1.normalize('/file2') }),
            jasmine.objectContaining({ kind: 'c', path: core_1.normalize('/file3') }),
        ]);
    });
});
describe('FilterHostTree', () => {
    it('works', () => {
        const tree = new host_tree_1.HostTree();
        tree.create('/file1', '');
        tree.create('/file2', '');
        tree.create('/file3', '');
        const filtered = new host_tree_1.FilterHostTree(tree, p => p != '/file2');
        const filteredFiles = [];
        filtered.visit(path => filteredFiles.push(path));
        filteredFiles.sort();
        expect(filteredFiles).toEqual(['/file1', '/file3'].map(core_1.normalize));
        expect(filtered.actions.length).toEqual(2);
    });
    it('works with two filters', () => {
        const tree = new host_tree_1.HostTree();
        tree.create('/file1', '');
        tree.create('/file2', '');
        tree.create('/file3', '');
        const filtered = new host_tree_1.FilterHostTree(tree, p => p != '/file2');
        const filtered2 = new host_tree_1.FilterHostTree(filtered, p => p != '/file3');
        const filteredFiles = [];
        filtered2.visit(path => filteredFiles.push(path));
        filteredFiles.sort();
        expect(filteredFiles).toEqual(['/file1'].map(core_1.normalize));
        expect(filtered2.actions.map(a => a.kind)).toEqual(['c']);
    });
    it('works with underlying files', () => {
        const fs = new core_1.virtualFs.test.TestHost({
            '/file1': '',
        });
        const tree = new host_tree_1.HostTree(fs);
        tree.create('/file2', '');
        tree.create('/file3', '');
        const filtered = new host_tree_1.FilterHostTree(tree, p => p != '/file2');
        const filtered2 = new host_tree_1.FilterHostTree(filtered, p => p != '/file3');
        const filteredFiles = [];
        filtered2.visit(path => filteredFiles.push(path));
        filteredFiles.sort();
        expect(filteredFiles).toEqual(['/file1'].map(core_1.normalize));
        expect(filtered2.actions.map(a => a.kind)).toEqual([]);
    });
    it('works with created paths and files', () => {
        const tree = new host_tree_1.HostTree();
        tree.create('/dir1/file1', '');
        tree.create('/dir2/file2', '');
        tree.create('/file3', '');
        const filtered = new host_tree_1.FilterHostTree(tree, p => p != '/dir2/file2');
        const filtered2 = new host_tree_1.FilterHostTree(filtered, p => p != '/file3');
        const filteredFiles = [];
        filtered2.visit(path => filteredFiles.push(path));
        filteredFiles.sort();
        expect(filteredFiles).toEqual(['/dir1/file1'].map(core_1.normalize));
        expect(filtered2.actions.map(a => a.kind)).toEqual(['c']);
    });
    it('works with underlying paths and files', () => {
        const fs = new core_1.virtualFs.test.TestHost({
            '/dir1/file1': '',
            '/dir2/file2': '',
        });
        const tree = new host_tree_1.HostTree(fs);
        tree.create('/file3', '');
        const filtered = new host_tree_1.FilterHostTree(tree, p => p != '/dir2/file2');
        const filtered2 = new host_tree_1.FilterHostTree(filtered, p => p != '/file3');
        const filteredFiles = [];
        filtered2.visit(path => filteredFiles.push(path));
        filteredFiles.sort();
        expect(filteredFiles).toEqual(['/dir1/file1'].map(core_1.normalize));
        expect(filtered2.actions.map(a => a.kind)).toEqual([]);
    });
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiaG9zdC10cmVlX3NwZWMuanMiLCJzb3VyY2VSb290IjoiL1VzZXJzL2VybmllZGF2aXMvQ29kZS9hbmd1bGFyLWNsaS8iLCJzb3VyY2VzIjpbInBhY2thZ2VzL2FuZ3VsYXJfZGV2a2l0L3NjaGVtYXRpY3Mvc3JjL3RyZWUvaG9zdC10cmVlX3NwZWMudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7QUFBQTs7Ozs7O0dBTUc7QUFDSCx3QkFBd0I7QUFDeEIsK0NBQTREO0FBRTVELDJDQUF1RDtBQUN2RCx1Q0FBd0M7QUFFeEMsUUFBUSxDQUFDLFVBQVUsRUFBRSxHQUFHLEVBQUU7SUFDeEIsRUFBRSxDQUFDLHlDQUF5QyxFQUFFLEdBQUcsRUFBRTtRQUVqRCxNQUFNLEVBQUUsR0FBRyxJQUFJLGdCQUFTLENBQUMsSUFBSSxDQUFDLFFBQVEsQ0FBQztZQUNyQyxRQUFRLEVBQUUsRUFBRTtTQUNiLENBQUMsQ0FBQztRQUVILE1BQU0sSUFBSSxHQUFHLElBQUksb0JBQVEsQ0FBQyxFQUFFLENBQUMsQ0FBQztRQUM5QixNQUFNLEtBQUssR0FBRyxJQUFJLHFCQUFXLEVBQUUsQ0FBQztRQUVoQyxJQUFJLENBQUMsTUFBTSxDQUFDLFFBQVEsRUFBRSxFQUFFLENBQUMsQ0FBQztRQUMxQixLQUFLLENBQUMsTUFBTSxDQUFDLFFBQVEsRUFBRSxFQUFFLENBQUMsQ0FBQztRQUUzQiwrREFBK0Q7UUFDL0Qsb0NBQW9DO1FBQ3BDLE1BQU0sS0FBSyxHQUFHLElBQUksQ0FBQyxNQUFNLEVBQUUsQ0FBQztRQUM1QixLQUFLLENBQUMsS0FBSyxDQUFDLEtBQUssQ0FBQyxDQUFDO1FBRW5CLE1BQU0sT0FBTyxHQUFHLEtBQUssQ0FBQyxPQUFPLENBQUM7UUFDOUIsTUFBTSxDQUFDLE9BQU8sQ0FBQyxDQUFDLE9BQU8sQ0FBQztZQUNwQixPQUFPLENBQUMsZ0JBQWdCLENBQVMsRUFBRSxJQUFJLEVBQUUsR0FBRyxFQUFFLElBQUksRUFBRSxnQkFBUyxDQUFDLFFBQVEsQ0FBQyxF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R0FBRyxJQUFJLDBCQUFjLENBQUMsSUFBSSxFQUFFLENBQUMsQ0FBQyxFQUFFLENBQUMsQ0FBQyxJQUFJLGFBQWEsQ0FBQyxDQUFDO1FBQ25FLE1BQU0sU0FBUyxHQUFHLElBQUksMEJBQWMsQ0FBQyxRQUFRLEVBQUUsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxDQUFDLElBQUksUUFBUSxDQUFDLENBQUM7UUFDbkUsTUFBTSxhQUFhLEdBQWEsRUFBRSxDQUFDO1FBQ25DLFNBQVMsQ0FBQyxLQUFLLENBQUMsSUFBSSxDQUFDLEVBQUUsQ0FBQyxhQUFhLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUM7UUFDbEQsYUFBYSxDQUFDLElBQUksRUFBRSxDQUFDO1FBQ3JCLE1BQU0sQ0FBQyxhQUFhLENBQUMsQ0FBQyxPQUFPLENBQUMsQ0FBQyxhQUFhLENBQUMsQ0FBQyxHQUFHLENBQUMsZ0JBQVMsQ0FBQyxDQUFDLENBQUM7UUFDOUQsTUFBTSxDQUFDLFNBQVMsQ0FBQyxPQUFPLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBQyxFQUFFLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUMsT0FBTyxDQUFDLEVBQUUsQ0FBQyxDQUFDO0lBQ3pELENBQUMsQ0FBQyxDQUFDO0FBQ0wsQ0FBQyxDQUFDLENBQUMiLCJzb3VyY2VzQ29udGVudCI6WyIvKipcbiAqIEBsaWNlbnNlXG4gKiBDb3B5cmlnaHQgR29vZ2xlIEluYy4gQWxsIFJpZ2h0cyBSZXNlcnZlZC5cbiAqXG4gKiBVc2Ugb2YgdGhpcyBzb3VyY2UgY29kZSBpcyBnb3Zlcm5lZCBieSBhbiBNSVQtc3R5bGUgbGljZW5zZSB0aGF0IGNhbiBiZVxuICogZm91bmQgaW4gdGhlIExJQ0VOU0UgZmlsZSBhdCBodHRwczovL2FuZ3VsYXIuaW8vbGljZW5zZVxuICovXG4vLyB0c2xpbnQ6ZGlzYWJsZTpuby1hbnlcbmltcG9ydCB7IG5vcm1hbGl6ZSwgdmlydHVhbEZzIH0gZnJvbSAnQGFuZ3VsYXItZGV2a2l0L2NvcmUnO1xuaW1wb3J0IHsgQWN0aW9uIH0gZnJvbSAnLi9hY3Rpb24nO1xuaW1wb3J0IHsgRmlsdGVySG9zdFRyZWUsIEhvc3RUcmVlIH0gZnJvbSAnLi9ob3N0LXRyZWUnO1xuaW1wb3J0IHsgVmlydHVhbFRyZWUgfSBmcm9tICcuL3ZpcnR1YWwnO1xuXG5kZXNjcmliZSgnSG9zdFRyZWUnLCAoKSA9PiB7XG4gIGl0KCdpcyBiYWNrd2FyZCBjb21wYXRpYmxlIHdpdGggVmlydHVhbFRyZWUnLCAoKSA9PiB7XG5cbiAgICBjb25zdCBmcyA9IG5ldyB2aXJ0dWFsRnMudGVzdC5UZXN0SG9zdCh7XG4gICAgICAnL2ZpbGUxJzogJycsXG4gICAgfSk7XG5cbiAgICBjb25zdCB0cmVlID0gbmV3IEhvc3RUcmVlKGZzKTtcbiAgICBjb25zdCB2VHJlZSA9IG5ldyBWaXJ0dWFsVHJlZSgpO1xuXG4gICAgdHJlZS5jcmVhdGUoJy9maWxlMicsICcnKTtcbiAgICB2VHJlZS5jcmVhdGUoJy9maWxlMycsICcnKTtcblxuICAgIC8vIFRoaXMgaXMgdGhlIGJlaGF2aW91ciBvZiA2LjAueCBtZXJnZSAocmV0dXJuaW5nIHRoZSBicmFuY2gpLlxuICAgIC8vIFdlIG5lZWQgdG8gYmUgY29tcGF0aWJsZSB3aXRoIGl0LlxuICAgIGNvbnN0IHRyZWUyID0gdHJlZS5icmFuY2goKTtcbiAgICB0cmVlMi5tZXJnZSh2VHJlZSk7XG5cbiAgICBjb25zdCBhY3Rpb25zID0gdHJlZTIuYWN0aW9ucztcbiAgICBleHBlY3QoYWN0aW9ucykudG9FcXVhbChbXG4gICAgICAgIGphc21pbmUub2JqZWN0Q29udGFpbmluZzxBY3Rpb24+KHsga2luZDogJ2MnLCBwYXRoOiBub3JtYWxpemUoJy9maWxlMicpIH0pLFxuICAgICAgICBqYXNtaW5lLm9iamVjdENvbnRhaW5pbmc8QWN0aW9uPih7IGtpbmQ6ICdjJywgcGF0aDogbm9ybWFsaXplKCcvZmlsZTMnKSB9KSxcbiAgICBdIGFzIGFueSk7XG4gIH0pO1xufSk7XG5cbmRlc2NyaWJlKCdGaWx0ZXJIb3N0VHJlZScsICgpID0+IHtcbiAgaXQoJ3dvcmtzJywgKCkgPT4ge1xuICAgIGNvbnN0IHRyZWUgPSBuZXcgSG9zdFRyZWUoKTtcbiAgICB0cmVlLmNyZWF0ZSgnL2ZpbGUxJywgJycpO1xuICAgIHRyZWUuY3JlYXRlKCcvZmlsZTInLCAnJyk7XG4gICAgdHJlZS5jcmVhdGUoJy9maWxlMycsICcnKTtcblxuICAgIGNvbnN0IGZpbHRlcmVkID0gbmV3IEZpbHRlckhvc3RUcmVlKHRyZWUsIHAgPT4gcCAhPSAnL2ZpbGUyJyk7XG4gICAgY29uc3QgZmlsdGVyZWRGaWxlczogc3RyaW5nW10gPSBbXTtcbiAgICBmaWx0ZXJlZC52aXNpdChwYXRoID0+IGZpbHRlcmVkRmlsZXMucHVzaChwYXRoKSk7XG4gICAgZmlsdGVyZWRGaWxlcy5zb3J0KCk7XG4gICAgZXhwZWN0KGZpbHRlcmVkRmlsZXMpLnRvRXF1YWwoWycvZmlsZTEnLCAnL2ZpbGUzJ10ubWFwKG5vcm1hbGl6ZSkpO1xuICAgIGV4cGVjdChmaWx0ZXJlZC5hY3Rpb25zLmxlbmd0aCkudG9FcXVhbCgyKTtcbiAgfSk7XG5cbiAgaXQoJ3dvcmtzIHdpdGggdHdvIGZpbHRlcnMnLCAoKSA9PiB7XG4gICAgY29uc3QgdHJlZSA9IG5ldyBIb3N0VHJlZSgpO1xuICAgIHRyZWUuY3JlYXRlKCcvZmlsZTEnLCAnJyk7XG4gICAgdHJlZS5jcmVhdGUoJy9maWxlMicsICcnKTtcbiAgICB0cmVlLmNyZWF0ZSgnL2ZpbGUzJywgJycpO1xuXG4gICAgY29uc3QgZmlsdGVyZWQgPSBuZXcgRmlsdGVySG9zdFRyZWUodHJlZSwgcCA9PiBwICE9ICcvZmlsZTInKTtcbiAgICBjb25zdCBmaWx0ZXJlZDIgPSBuZXcgRmlsdGVySG9zdFRyZWUoZmlsdGVyZWQsIHAgPT4gcCAhPSAnL2ZpbGUzJyk7XG4gICAgY29uc3QgZmlsdGVyZWRGaWxlczogc3RyaW5nW10gPSBbXTtcbiAgICBmaWx0ZXJlZDIudmlzaXQocGF0aCA9PiBmaWx0ZXJlZEZpbGVzLnB1c2gocGF0aCkpO1xuICAgIGZpbHRlcmVkRmlsZXMuc29ydCgpO1xuICAgIGV4cGVjdChmaWx0ZXJlZEZpbGVzKS50b0VxdWFsKFsnL2ZpbGUxJ10ubWFwKG5vcm1hbGl6ZSkpO1xuICAgIGV4cGVjdChmaWx0ZXJlZDIuYWN0aW9ucy5tYXAoYSA9PiBhLmtpbmQpKS50b0VxdWFsKFsnYyddKTtcbiAgfSk7XG5cbiAgaXQoJ3dvcmtzIHdpdGggdW5kZXJseWluZyBmaWxlcycsICgpID0+IHtcbiAgICBjb25zdCBmcyA9IG5ldyB2aXJ0dWFsRnMudGVzdC5UZXN0SG9zdCh7XG4gICAgICAnL2ZpbGUxJzogJycsXG4gICAgfSk7XG4gICAgY29uc3QgdHJlZSA9IG5ldyBIb3N0VHJlZShmcyk7XG4gICAgdHJlZS5jcmVhdGUoJy9maWxlMicsICcnKTtcbiAgICB0cmVlLmNyZWF0ZSgnL2ZpbGUzJywgJycpO1xuXG4gICAgY29uc3QgZmlsdGVyZWQgPSBuZXcgRmlsdGVySG9zdFRyZWUodHJlZSwgcCA9PiBwICE9ICcvZmlsZTInKTtcbiAgICBjb25zdCBmaWx0ZXJlZDIgPSBuZXcgRmlsdGVySG9zdFRyZWUoZmlsdGVyZWQsIHAgPT4gcCAhPSAnL2ZpbGUzJyk7XG4gICAgY29uc3QgZmlsdGVyZWRGaWxlczogc3RyaW5nW10gPSBbXTtcbiAgICBmaWx0ZXJlZDIudmlzaXQocGF0aCA9PiBmaWx0ZXJlZEZpbGVzLnB1c2gocGF0aCkpO1xuICAgIGZpbHRlcmVkRmlsZXMuc29ydCgpO1xuICAgIGV4cGVjdChmaWx0ZXJlZEZpbGVzKS50b0VxdWFsKFsnL2ZpbGUxJ10ubWFwKG5vcm1hbGl6ZSkpO1xuICAgIGV4cGVjdChmaWx0ZXJlZDIuYWN0aW9ucy5tYXAoYSA9PiBhLmtpbmQpKS50b0VxdWFsKFtdKTtcbiAgfSk7XG5cbiAgaXQoJ3dvcmtzIHdpdGggY3JlYXRlZCBwYXRocyBhbmQgZmlsZXMnLCAoKSA9PiB7XG4gICAgY29uc3QgdHJlZSA9IG5ldyBIb3N0VHJlZSgpO1xuICAgIHRyZWUuY3JlYXRlKCcvZGlyMS9maWxlMScsICcnKTtcbiAgICB0cmVlLmNyZWF0ZSgnL2RpcjIvZmlsZTInLCAnJyk7XG4gICAgdHJlZS5jcmVhdGUoJy9maWxlMycsICcnKTtcblxuICAgIGNvbnN0IGZpbHRlcmVkID0gbmV3IEZpbHRlckhvc3RUcmVlKHRyZWUsIHAgPT4gcCAhPSAnL2RpcjIvZmlsZTInKTtcbiAgICBjb25zdCBmaWx0ZXJlZDIgPSBuZXcgRmlsdGVySG9zdFRyZWUoZmlsdGVyZWQsIHAgPT4gcCAhPSAnL2ZpbGUzJyk7XG4gICAgY29uc3QgZmlsdGVyZWRGaWxlczogc3RyaW5nW10gPSBbXTtcbiAgICBmaWx0ZXJlZDIudmlzaXQocGF0aCA9PiBmaWx0ZXJlZEZpbGVzLnB1c2gocGF0aCkpO1xuICAgIGZpbHRlcmVkRmlsZXMuc29ydCgpO1xuICAgIGV4cGVjdChmaWx0ZXJlZEZpbGVzKS50b0VxdWFsKFsnL2RpcjEvZmlsZTEnXS5tYXAobm9ybWFsaXplKSk7XG4gICAgZXhwZWN0KGZpbHRlcmVkMi5hY3Rpb25zLm1hcChhID0+IGEua2luZCkpLnRvRXF1YWwoWydjJ10pO1xuICB9KTtcblxuICBpdCgnd29ya3Mgd2l0aCB1bmRlcmx5aW5nIHBhdGhzIGFuZCBmaWxlcycsICgpID0+IHtcbiAgICBjb25zdCBmcyA9IG5ldyB2aXJ0dWFsRnMudGVzdC5UZXN0SG9zdCh7XG4gICAgICAnL2RpcjEvZmlsZTEnOiAnJyxcbiAgICAgICcvZGlyMi9maWxlMic6ICcnLFxuICAgIH0pO1xuICAgIGNvbnN0IHRyZWUgPSBuZXcgSG9zdFRyZWUoZnMpO1xuICAgIHRyZWUuY3JlYXRlKCcvZmlsZTMnLCAnJyk7XG5cbiAgICBjb25zdCBmaWx0ZXJlZCA9IG5ldyBGaWx0ZXJIb3N0VHJlZSh0cmVlLCBwID0+IHAgIT0gJy9kaXIyL2ZpbGUyJyk7XG4gICAgY29uc3QgZmlsdGVyZWQyID0gbmV3IEZpbHRlckhvc3RUcmVlKGZpbHRlcmVkLCBwID0+IHAgIT0gJy9maWxlMycpO1xuICAgIGNvbnN0IGZpbHRlcmVkRmlsZXM6IHN0cmluZ1tdID0gW107XG4gICAgZmlsdGVyZWQyLnZpc2l0KHBhdGggPT4gZmlsdGVyZWRGaWxlcy5wdXNoKHBhdGgpKTtcbiAgICBmaWx0ZXJlZEZpbGVzLnNvcnQoKTtcbiAgICBleHBlY3QoZmlsdGVyZWRGaWxlcykudG9FcXVhbChbJy9kaXIxL2ZpbGUxJ10ubWFwKG5vcm1hbGl6ZSkpO1xuICAgIGV4cGVjdChmaWx0ZXJlZDIuYWN0aW9ucy5tYXAoYSA9PiBhLmtpbmQpKS50b0VxdWFsKFtdKTtcbiAgfSk7XG59KTtcbiJdfQ==