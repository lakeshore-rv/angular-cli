"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
/**
 * @license
 * Copyright Google Inc. All Rights Reserved.
 *
 * Use of this source code is governed by an MIT-style license that can be
 * found in the LICENSE file at https://angular.io/license
 */
// tslint:disable:no-implicit-dependencies
// tslint:disable:non-null-operator
const core_1 = require("@angular-devkit/core");
const schematics_1 = require("@angular-devkit/schematics");
const rxjs_1 = require("rxjs");
const static_1 = require("../tree/static");
const base_1 = require("./base");
const call_1 = require("./call");
const context = {
    engine: null,
    debug: false,
    strategy: schematics_1.MergeStrategy.Default,
};
describe('chain', () => {
    it('works with simple rules', done => {
        const rulesCalled = [];
        const tree0 = static_1.empty();
        const tree1 = static_1.empty();
        const tree2 = static_1.empty();
        const tree3 = static_1.empty();
        const rule0 = (tree) => (rulesCalled[0] = tree, tree1);
        const rule1 = (tree) => (rulesCalled[1] = tree, tree2);
        const rule2 = (tree) => (rulesCalled[2] = tree, tree3);
        call_1.callRule(base_1.chain([rule0, rule1, rule2]), rxjs_1.of(tree0), context)
            .toPromise()
            .then(result => {
            expect(result).not.toBe(tree0);
            expect(rulesCalled[0]).toBe(tree0);
            expect(rulesCalled[1]).toBe(tree1);
            expect(rulesCalled[2]).toBe(tree2);
            expect(result).toBe(tree3);
        })
            .then(done, done.fail);
    });
    it('works with observable rules', done => {
        const rulesCalled = [];
        const tree0 = static_1.empty();
        const tree1 = static_1.empty();
        const tree2 = static_1.empty();
        const tree3 = static_1.empty();
        const rule0 = (tree) => (rulesCalled[0] = tree, rxjs_1.of(tree1));
        const rule1 = (tree) => (rulesCalled[1] = tree, rxjs_1.of(tree2));
        const rule2 = (tree) => (rulesCalled[2] = tree, tree3);
        call_1.callRule(base_1.chain([rule0, rule1, rule2]), rxjs_1.of(tree0), context)
            .toPromise()
            .then(result => {
            expect(result).not.toBe(tree0);
            expect(rulesCalled[0]).toBe(tree0);
            expect(rulesCalled[1]).toBe(tree1);
            expect(rulesCalled[2]).toBe(tree2);
            expect(result).toBe(tree3);
        })
            .then(done, done.fail);
    });
});
describe('apply', () => {
    it('works with simple rules', done => {
        const rulesCalled = [];
        let sourceCalled = false;
        const tree0 = static_1.empty();
        const tree1 = static_1.empty();
        const tree2 = static_1.empty();
        const tree3 = static_1.empty();
        const source = () => (sourceCalled = true, tree0);
        const rule0 = (tree) => (rulesCalled[0] = tree, tree1);
        const rule1 = (tree) => (rulesCalled[1] = tree, tree2);
        const rule2 = (tree) => (rulesCalled[2] = tree, tree3);
        call_1.callSource(base_1.apply(source, [rule0, rule1, rule2]), context)
            .toPromise()
            .then(result => {
            expect(result).not.toBe(tree0);
            expect(rulesCalled[0]).toBe(tree0);
            expect(rulesCalled[1]).toBe(tree1);
            expect(rulesCalled[2]).toBe(tree2);
            expect(result).toBe(tree3);
        })
            .then(done, done.fail);
    });
    it('works with observable rules', done => {
        const rulesCalled = [];
        let sourceCalled = false;
        const tree0 = static_1.empty();
        const tree1 = static_1.empty();
        const tree2 = static_1.empty();
        const tree3 = static_1.empty();
        const source = () => (sourceCalled = true, tree0);
        const rule0 = (tree) => (rulesCalled[0] = tree, rxjs_1.of(tree1));
        const rule1 = (tree) => (rulesCalled[1] = tree, rxjs_1.of(tree2));
        const rule2 = (tree) => (rulesCalled[2] = tree, tree3);
        call_1.callSource(base_1.apply(source, [rule0, rule1, rule2]), context)
            .toPromise()
            .then(result => {
            expect(result).not.toBe(tree0);
            expect(rulesCalled[0]).toBe(tree0);
            expect(rulesCalled[1]).toBe(tree1);
            expect(rulesCalled[2]).toBe(tree2);
            expect(result).toBe(tree3);
        })
            .then(done, done.fail);
    });
});
describe('partitionApplyMerge', () => {
    it('works with simple rules', done => {
        const host = new core_1.virtualFs.test.TestHost({
            '/test1': '',
            '/test2': '',
        });
        const tree = new schematics_1.HostTree(host);
        const predicate = (path) => path.indexOf('1') != -1;
        const ruleYes = (tree) => {
            expect(tree.exists('/test1')).toBe(true);
            expect(tree.exists('/test2')).toBe(false);
            return static_1.empty();
        };
        const ruleNo = (tree) => {
            expect(tree.exists('/test1')).toBe(false);
            expect(tree.exists('/test2')).toBe(true);
            return static_1.empty();
        };
        call_1.callRule(schematics_1.partitionApplyMerge(predicate, ruleYes, ruleNo), rxjs_1.of(tree), context)
            .toPromise()
            .then(result => {
            expect(result.exists('/test1')).toBe(false);
            expect(result.exists('/test2')).toBe(false);
        })
            .then(done, done.fail);
    });
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYmFzZV9zcGVjLmpzIiwic291cmNlUm9vdCI6Ii9Vc2Vycy9lcm5pZWRhdmlzL0NvZGUvYW5ndWxhci1jbGkvIiwic291cmNlcyI6WyJwYWNrYWdlcy9hbmd1bGFyX2RldmtpdC9zY2hlbWF0aWNzL3NyYy9ydWxlcy9iYXNlX3NwZWMudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7QUFBQTs7Ozs7O0dBTUc7QUFDSCwwQ0FBMEM7QUFDMUMsbUNBQW1DO0FBQ25DLCtDQUF1RDtBQUN2RCwyREFJb0M7QUFDcEMsK0JBQTBDO0FBRzFDLDJDQUF1QztBQUN2QyxpQ0FBc0M7QUFDdEMsaUNBQThDO0FBRzlDLE1BQU0sT0FBTyxHQUFxQjtJQUNoQyxNQUFNLEVBQUUsSUFBSTtJQUNaLEtBQUssRUFBRSxLQUFLO0lBQ1osUUFBUSxFQUFFLDBCQUFhLENBQUMsT0FBTztDQUNOLENBQUM7QUFHNUIsUUFBUSxDQUFDLE9BQU8sRUFBRSxHQUFHLEVBQUU7SUFDckIsRUFBRSxDQUFDLHlCQUF5QixFQUFFLElBQUksQ0FBQyxFQUFFO1FBQ25DLE1BQU0sV0FBVyxHQUFXLEVBQUUsQ0FBQztRQUUvQixNQUFNLEtBQUssR0FBRyxjQUFLLEVBQUUsQ0FBQztRQUN0QixNQUFNLEtBQUssR0FBRyxjQUFLLEVBQUUsQ0FBQztRQUN0QixNQUFNLEtBQUssR0FBRyxjQUFLLEVBQUUsQ0FBQztRQUN0QixNQUFNLEtBQUssR0FBRyxjQUFLLEVBQUUsQ0FBQztRQUV0QixNQUFNLEtBQUssR0FBUyxDQUFDLElBQVUsRUFBRSxFQUFFLENBQUMsQ0FBQyxXQUFXLENBQUMsQ0FBQyxDQUFDLEdBQUcsSUFBSSxFQUFFLEtBQUssQ0FBQyxDQUFDO1FBQ25FLE1BQU0sS0FBSyxHQUFTLENBQUMsSUFBVSxFQUFFLEVBQUUsQ0FBQyxDQUFDLFdBQVcsQ0FBQyxDQUFDLENBQUMsR0FBRyxJQUFJLEVBQUUsS0FBSyxDQUFDLENBQUM7UUFDbkUsTUFBTSxLQUFLLEdBQVMsQ0FBQyxJQUFVLEVBQUUsRUFB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SUFBSSxFQUFFLElBQUksQ0FBQyxJQUFJLENBQUMsQ0FBQztJQUMzQixDQUFDLENBQUMsQ0FBQztBQUNMLENBQUMsQ0FBQyxDQUFDIiwic291cmNlc0NvbnRlbnQiOlsiLyoqXG4gKiBAbGljZW5zZVxuICogQ29weXJpZ2h0IEdvb2dsZSBJbmMuIEFsbCBSaWdodHMgUmVzZXJ2ZWQuXG4gKlxuICogVXNlIG9mIHRoaXMgc291cmNlIGNvZGUgaXMgZ292ZXJuZWQgYnkgYW4gTUlULXN0eWxlIGxpY2Vuc2UgdGhhdCBjYW4gYmVcbiAqIGZvdW5kIGluIHRoZSBMSUNFTlNFIGZpbGUgYXQgaHR0cHM6Ly9hbmd1bGFyLmlvL2xpY2Vuc2VcbiAqL1xuLy8gdHNsaW50OmRpc2FibGU6bm8taW1wbGljaXQtZGVwZW5kZW5jaWVzXG4vLyB0c2xpbnQ6ZGlzYWJsZTpub24tbnVsbC1vcGVyYXRvclxuaW1wb3J0IHsgUGF0aCwgdmlydHVhbEZzIH0gZnJvbSAnQGFuZ3VsYXItZGV2a2l0L2NvcmUnO1xuaW1wb3J0IHtcbiAgSG9zdFRyZWUsXG4gIE1lcmdlU3RyYXRlZ3ksXG4gIHBhcnRpdGlvbkFwcGx5TWVyZ2UsXG59IGZyb20gJ0Bhbmd1bGFyLWRldmtpdC9zY2hlbWF0aWNzJztcbmltcG9ydCB7IG9mIGFzIG9ic2VydmFibGVPZiB9IGZyb20gJ3J4anMnO1xuaW1wb3J0IHsgUnVsZSwgU2NoZW1hdGljQ29udGV4dCwgU291cmNlIH0gZnJvbSAnLi4vZW5naW5lL2ludGVyZmFjZSc7XG5pbXBvcnQgeyBUcmVlIH0gZnJvbSAnLi4vdHJlZS9pbnRlcmZhY2UnO1xuaW1wb3J0IHsgZW1wdHkgfSBmcm9tICcuLi90cmVlL3N0YXRpYyc7XG5pbXBvcnQgeyBhcHBseSwgY2hhaW4gfSBmcm9tICcuL2Jhc2UnO1xuaW1wb3J0IHsgY2FsbFJ1bGUsIGNhbGxTb3VyY2UgfSBmcm9tICcuL2NhbGwnO1xuXG5cbmNvbnN0IGNvbnRleHQ6IFNjaGVtYXRpY0NvbnRleHQgPSB7XG4gIGVuZ2luZTogbnVsbCxcbiAgZGVidWc6IGZhbHNlLFxuICBzdHJhdGVneTogTWVyZ2VTdHJhdGVneS5EZWZhdWx0LFxufSBhcyB7fSBhcyBTY2hlbWF0aWNDb250ZXh0O1xuXG5cbmRlc2NyaWJlKCdjaGFpbicsICgpID0+IHtcbiAgaXQoJ3dvcmtzIHdpdGggc2ltcGxlIHJ1bGVzJywgZG9uZSA9PiB7XG4gICAgY29uc3QgcnVsZXNDYWxsZWQ6IFRyZWVbXSA9IFtdO1xuXG4gICAgY29uc3QgdHJlZTAgPSBlbXB0eSgpO1xuICAgIGNvbnN0IHRyZWUxID0gZW1wdHkoKTtcbiAgICBjb25zdCB0cmVlMiA9IGVtcHR5KCk7XG4gICAgY29uc3QgdHJlZTMgPSBlbXB0eSgpO1xuXG4gICAgY29uc3QgcnVsZTA6IFJ1bGUgPSAodHJlZTogVHJlZSkgPT4gKHJ1bGVzQ2FsbGVkWzBdID0gdHJlZSwgdHJlZTEpO1xuICAgIGNvbnN0IHJ1bGUxOiBSdWxlID0gKHRyZWU6IFRyZWUpID0+IChydWxlc0NhbGxlZFsxXSA9IHRyZWUsIHRyZWUyKTtcbiAgICBjb25zdCBydWxlMjogUnVsZSA9ICh0cmVlOiBUcmVlKSA9PiAocnVsZXNDYWxsZWRbMl0gPSB0cmVlLCB0cmVlMyk7XG5cbiAgICBjYWxsUnVsZShjaGFpbihbIHJ1bGUwLCBydWxlMSwgcnVsZTIgXSksIG9ic2VydmFibGVPZih0cmVlMCksIGNvbnRleHQpXG4gICAgICAudG9Qcm9taXNlKClcbiAgICAgIC50aGVuKHJlc3VsdCA9PiB7XG4gICAgICAgIGV4cGVjdChyZXN1bHQpLm5vdC50b0JlKHRyZWUwKTtcbiAgICAgICAgZXhwZWN0KHJ1bGVzQ2FsbGVkWzBdKS50b0JlKHRyZWUwKTtcbiAgICAgICAgZXhwZWN0KHJ1bGVzQ2FsbGVkWzFdKS50b0JlKHRyZWUxKTtcbiAgICAgICAgZXhwZWN0KHJ1bGVzQ2FsbGVkWzJdKS50b0JlKHRyZWUyKTtcbiAgICAgICAgZXhwZWN0KHJlc3VsdCkudG9CZSh0cmVlMyk7XG4gICAgICB9KVxuICAgICAgLnRoZW4oZG9uZSwgZG9uZS5mYWlsKTtcbiAgfSk7XG5cbiAgaXQoJ3dvcmtzIHdpdGggb2JzZXJ2YWJsZSBydWxlcycsIGRvbmUgPT4ge1xuICAgIGNvbnN0IHJ1bGVzQ2FsbGVkOiBUcmVlW10gPSBbXTtcblxuICAgIGNvbnN0IHRyZWUwID0gZW1wdHkoKTtcbiAgICBjb25zdCB0cmVlMSA9IGVtcHR5KCk7XG4gICAgY29uc3QgdHJlZTIgPSBlbXB0eSgpO1xuICAgIGNvbnN0IHRyZWUzID0gZW1wdHkoKTtcblxuICAgIGNvbnN0IHJ1bGUwOiBSdWxlID0gKHRyZWU6IFRyZWUpID0+IChydWxlc0NhbGxlZFswXSA9IHRyZWUsIG9ic2VydmFibGVPZih0cmVlMSkpO1xuICAgIGNvbnN0IHJ1bGUxOiBSdWxlID0gKHRyZWU6IFRyZWUpID0+IChydWxlc0NhbGxlZFsxXSA9IHRyZWUsIG9ic2VydmFibGVPZih0cmVlMikpO1xuICAgIGNvbnN0IHJ1bGUyOiBSdWxlID0gKHRyZWU6IFRyZWUpID0+IChydWxlc0NhbGxlZFsyXSA9IHRyZWUsIHRyZWUzKTtcblxuICAgIGNhbGxSdWxlKGNoYWluKFsgcnVsZTAsIHJ1bGUxLCBydWxlMiBdKSwgb2JzZXJ2YWJsZU9mKHRyZWUwKSwgY29udGV4dClcbiAgICAgIC50b1Byb21pc2UoKVxuICAgICAgLnRoZW4ocmVzdWx0ID0+IHtcbiAgICAgICAgZXhwZWN0KHJlc3VsdCkubm90LnRvQmUodHJlZTApO1xuICAgICAgICBleHBlY3QocnVsZXNDYWxsZWRbMF0pLnRvQmUodHJlZTApO1xuICAgICAgICBleHBlY3QocnVsZXNDYWxsZWRbMV0pLnRvQmUodHJlZTEpO1xuICAgICAgICBleHBlY3QocnVsZXNDYWxsZWRbMl0pLnRvQmUodHJlZTIpO1xuICAgICAgICBleHBlY3QocmVzdWx0KS50b0JlKHRyZWUzKTtcbiAgICAgIH0pXG4gICAgICAudGhlbihkb25lLCBkb25lLmZhaWwpO1xuICB9KTtcbn0pO1xuXG5kZXNjcmliZSgnYXBwbHknLCAoKSA9PiB7XG4gIGl0KCd3b3JrcyB3aXRoIHNpbXBsZSBydWxlcycsIGRvbmUgPT4ge1xuICAgIGNvbnN0IHJ1bGVzQ2FsbGVkOiBUcmVlW10gPSBbXTtcbiAgICBsZXQgc291cmNlQ2FsbGVkID0gZmFsc2U7XG5cbiAgICBjb25zdCB0cmVlMCA9IGVtcHR5KCk7XG4gICAgY29uc3QgdHJlZTEgPSBlbXB0eSgpO1xuICAgIGNvbnN0IHRyZWUyID0gZW1wdHkoKTtcbiAgICBjb25zdCB0cmVlMyA9IGVtcHR5KCk7XG5cbiAgICBjb25zdCBzb3VyY2U6IFNvdXJjZSA9ICgpID0+IChzb3VyY2VDYWxsZWQgPSB0cnVlLCB0cmVlMCk7XG4gICAgY29uc3QgcnVsZTA6IFJ1bGUgPSAodHJlZTogVHJlZSkgPT4gKHJ1bGVzQ2FsbGVkWzBdID0gdHJlZSwgdHJlZTEpO1xuICAgIGNvbnN0IHJ1bGUxOiBSdWxlID0gKHRyZWU6IFRyZWUpID0+IChydWxlc0NhbGxlZFsxXSA9IHRyZWUsIHRyZWUyKTtcbiAgICBjb25zdCBydWxlMjogUnVsZSA9ICh0cmVlOiBUcmVlKSA9PiAocnVsZXNDYWxsZWRbMl0gPSB0cmVlLCB0cmVlMyk7XG5cbiAgICBjYWxsU291cmNlKGFwcGx5KHNvdXJjZSwgWyBydWxlMCwgcnVsZTEsIHJ1bGUyIF0pLCBjb250ZXh0KVxuICAgICAgLnRvUHJvbWlzZSgpXG4gICAgICAudGhlbihyZXN1bHQgPT4ge1xuICAgICAgICBleHBlY3QocmVzdWx0KS5ub3QudG9CZSh0cmVlMCk7XG4gICAgICAgIGV4cGVjdChydWxlc0NhbGxlZFswXSkudG9CZSh0cmVlMCk7XG4gICAgICAgIGV4cGVjdChydWxlc0NhbGxlZFsxXSkudG9CZSh0cmVlMSk7XG4gICAgICAgIGV4cGVjdChydWxlc0NhbGxlZFsyXSkudG9CZSh0cmVlMik7XG4gICAgICAgIGV4cGVjdChyZXN1bHQpLnRvQmUodHJlZTMpO1xuICAgICAgfSlcbiAgICAgIC50aGVuKGRvbmUsIGRvbmUuZmFpbCk7XG4gIH0pO1xuXG4gIGl0KCd3b3JrcyB3aXRoIG9ic2VydmFibGUgcnVsZXMnLCBkb25lID0+IHtcbiAgICBjb25zdCBydWxlc0NhbGxlZDogVHJlZVtdID0gW107XG4gICAgbGV0IHNvdXJjZUNhbGxlZCA9IGZhbHNlO1xuXG4gICAgY29uc3QgdHJlZTAgPSBlbXB0eSgpO1xuICAgIGNvbnN0IHRyZWUxID0gZW1wdHkoKTtcbiAgICBjb25zdCB0cmVlMiA9IGVtcHR5KCk7XG4gICAgY29uc3QgdHJlZTMgPSBlbXB0eSgpO1xuXG4gICAgY29uc3Qgc291cmNlOiBTb3VyY2UgPSAoKSA9PiAoc291cmNlQ2FsbGVkID0gdHJ1ZSwgdHJlZTApO1xuICAgIGNvbnN0IHJ1bGUwOiBSdWxlID0gKHRyZWU6IFRyZWUpID0+IChydWxlc0NhbGxlZFswXSA9IHRyZWUsIG9ic2VydmFibGVPZih0cmVlMSkpO1xuICAgIGNvbnN0IHJ1bGUxOiBSdWxlID0gKHRyZWU6IFRyZWUpID0+IChydWxlc0NhbGxlZFsxXSA9IHRyZWUsIG9ic2VydmFibGVPZih0cmVlMikpO1xuICAgIGNvbnN0IHJ1bGUyOiBSdWxlID0gKHRyZWU6IFRyZWUpID0+IChydWxlc0NhbGxlZFsyXSA9IHRyZWUsIHRyZWUzKTtcblxuICAgIGNhbGxTb3VyY2UoYXBwbHkoc291cmNlLCBbIHJ1bGUwLCBydWxlMSwgcnVsZTIgXSksIGNvbnRleHQpXG4gICAgICAudG9Qcm9taXNlKClcbiAgICAgIC50aGVuKHJlc3VsdCA9PiB7XG4gICAgICAgIGV4cGVjdChyZXN1bHQpLm5vdC50b0JlKHRyZWUwKTtcbiAgICAgICAgZXhwZWN0KHJ1bGVzQ2FsbGVkWzBdKS50b0JlKHRyZWUwKTtcbiAgICAgICAgZXhwZWN0KHJ1bGVzQ2FsbGVkWzFdKS50b0JlKHRyZWUxKTtcbiAgICAgICAgZXhwZWN0KHJ1bGVzQ2FsbGVkWzJdKS50b0JlKHRyZWUyKTtcbiAgICAgICAgZXhwZWN0KHJlc3VsdCkudG9CZSh0cmVlMyk7XG4gICAgICB9KVxuICAgICAgLnRoZW4oZG9uZSwgZG9uZS5mYWlsKTtcbiAgfSk7XG59KTtcblxuZGVzY3JpYmUoJ3BhcnRpdGlvbkFwcGx5TWVyZ2UnLCAoKSA9PiB7XG4gIGl0KCd3b3JrcyB3aXRoIHNpbXBsZSBydWxlcycsIGRvbmUgPT4ge1xuICAgIGNvbnN0IGhvc3QgPSBuZXcgdmlydHVhbEZzLnRlc3QuVGVzdEhvc3Qoe1xuICAgICAgJy90ZXN0MSc6ICcnLFxuICAgICAgJy90ZXN0Mic6ICcnLFxuICAgIH0pO1xuICAgIGNvbnN0IHRyZWUgPSBuZXcgSG9zdFRyZWUoaG9zdCk7XG4gICAgY29uc3QgcHJlZGljYXRlID0gKHBhdGg6IFBhdGgpID0+IHBhdGguaW5kZXhPZignMScpICE9IC0xO1xuXG4gICAgY29uc3QgcnVsZVllczogUnVsZSA9ICh0cmVlOiBUcmVlKSA9PiB7XG4gICAgICBleHBlY3QodHJlZS5leGlzdHMoJy90ZXN0MScpKS50b0JlKHRydWUpO1xuICAgICAgZXhwZWN0KHRyZWUuZXhpc3RzKCcvdGVzdDInKSkudG9CZShmYWxzZSk7XG5cbiAgICAgIHJldHVybiBlbXB0eSgpO1xuICAgIH07XG4gICAgY29uc3QgcnVsZU5vOiBSdWxlID0gKHRyZWU6IFRyZWUpID0+IHtcbiAgICAgIGV4cGVjdCh0cmVlLmV4aXN0cygnL3Rlc3QxJykpLnRvQmUoZmFsc2UpO1xuICAgICAgZXhwZWN0KHRyZWUuZXhpc3RzKCcvdGVzdDInKSkudG9CZSh0cnVlKTtcblxuICAgICAgcmV0dXJuIGVtcHR5KCk7XG4gICAgfTtcblxuICAgIGNhbGxSdWxlKHBhcnRpdGlvbkFwcGx5TWVyZ2UocHJlZGljYXRlLCBydWxlWWVzLCBydWxlTm8pLCBvYnNlcnZhYmxlT2YodHJlZSksIGNvbnRleHQpXG4gICAgICAudG9Qcm9taXNlKClcbiAgICAgIC50aGVuKHJlc3VsdCA9PiB7XG4gICAgICAgIGV4cGVjdChyZXN1bHQuZXhpc3RzKCcvdGVzdDEnKSkudG9CZShmYWxzZSk7XG4gICAgICAgIGV4cGVjdChyZXN1bHQuZXhpc3RzKCcvdGVzdDInKSkudG9CZShmYWxzZSk7XG4gICAgICB9KVxuICAgICAgLnRoZW4oZG9uZSwgZG9uZS5mYWlsKTtcbiAgfSk7XG59KTtcbiJdfQ==