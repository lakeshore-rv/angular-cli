"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
/**
 * @license
 * Copyright Google Inc. All Rights Reserved.
 *
 * Use of this source code is governed by an MIT-style license that can be
 * found in the LICENSE file at https://angular.io/license
 */
const core_1 = require("@angular-devkit/core");
const template_1 = require("./template");
function _entry(path, content) {
    if (!path) {
        path = 'a/b/c';
    }
    if (!content) {
        content = 'hello world';
    }
    return {
        path: core_1.normalize(path),
        content: Buffer.from(content),
    };
}
describe('applyPathTemplate', () => {
    function _applyPathTemplate(path, options) {
        const newEntry = template_1.applyPathTemplate(options)(_entry(path));
        if (newEntry) {
            return newEntry.path;
        }
        else {
            return null;
        }
    }
    it('works', () => {
        expect(_applyPathTemplate('/a/b/c/d', {})).toBe('/a/b/c/d');
        expect(_applyPathTemplate('/a/b/__c__/d', { c: 1 })).toBe('/a/b/1/d');
        expect(_applyPathTemplate('/a/b/__c__/d', { c: 'hello/world' })).toBe('/a/b/hello/world/d');
        expect(_applyPathTemplate('/a__c__b', { c: 'hello/world' })).toBe('/ahello/worldb');
        expect(_applyPathTemplate('/a__c__b__d__c', { c: '1', d: '2' })).toBe('/a1b2c');
    });
    it('works with single _', () => {
        expect(_applyPathTemplate('/a_b_c/d__e_f__g', { e_f: 1 })).toBe('/a_b_c/d1g');
    });
    it('works with functions', () => {
        let arg = '';
        expect(_applyPathTemplate('/a__c__b', {
            c: (x) => (arg = x, 'hello'),
        })).toBe('/ahellob');
        expect(arg).toBe('/a__c__b');
    });
    it('works with pipes', () => {
        let called = '';
        let called2 = '';
        expect(_applyPathTemplate('/a__c@d__b', {
            c: 1,
            d: (x) => (called = x, 2),
        })).toBe('/a2b');
        expect(called).toBe('1');
        expect(_applyPathTemplate('/a__c@d@e__b', {
            c: 10,
            d: (x) => (called = x, 20),
            e: (x) => (called2 = x, 30),
        })).toBe('/a30b');
        expect(called).toBe('10');
        expect(called2).toBe('20');
    });
    it('errors out on undefined values', () => {
        expect(() => _applyPathTemplate('/a__b__c', {})).toThrow(new template_1.OptionIsNotDefinedException('b'));
    });
    it('errors out on undefined or invalid pipes', () => {
        expect(() => _applyPathTemplate('/a__b@d__c', { b: 1 })).toThrow(new template_1.UnknownPipeException('d'));
        expect(() => _applyPathTemplate('/a__b@d__c', { b: 1, d: 1 }))
            .toThrow(new template_1.InvalidPipeException('d'));
    });
});
describe('contentTemplate', () => {
    function _applyContentTemplate(content, options) {
        const newEntry = template_1.applyContentTemplate(options)(_entry('', content));
        if (newEntry) {
            return newEntry.content.toString('utf-8');
        }
        else {
            return null;
        }
    }
    it('works with echo token <%= ... %>', () => {
        expect(_applyContentTemplate('a<%= value %>b', { value: 123 })).toBe('a123b');
    });
    it('works with if', () => {
        expect(_applyContentTemplate('a<% if (a) { %>b<% } %>c', {
            value: 123,
            a: true,
        })).toBe('abc');
        expect(_applyContentTemplate('a<% if (a) { %>b<% } %>c', {
            value: 123,
            a: false,
        })).toBe('ac');
    });
    it('works with for', () => {
        expect(_applyContentTemplate('a<% for (let i = 0; i < value; i++) { %>1<% } %>b', {
            value: 5,
        })).toBe('a11111b');
    });
    it('escapes HTML', () => {
        expect(_applyContentTemplate('a<%- html %>b', {
            html: '<script>',
        })).toBe('a&lt;script&gt;b');
    });
    it('escapes strings properly', () => {
        expect(_applyContentTemplate('a<%= value %>b', { value: `'abc'` })).toBe('a\'abc\'b');
        expect(_applyContentTemplate('a<%= \'a\' + "b" %>b', {})).toBe('aabb');
        expect(_applyContentTemplate('a<%= "\\n" + "b" %>b', {})).toBe('a\nbb');
    });
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidGVtcGxhdGVfc3BlYy5qcyIsInNvdXJjZVJvb3QiOiIvVXNlcnMvZXJuaWVkYXZpcy9Db2RlL2FuZ3VsYXItY2xpLyIsInNvdXJjZXMiOlsicGFja2FnZXMvYW5ndWxhcl9kZXZraXQvc2NoZW1hdGljcy9zcmMvcnVsZXMvdGVtcGxhdGVfc3BlYy50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOztBQUFBOzs7Ozs7R0FNRztBQUNILCtDQUFpRDtBQUVqRCx5Q0FNb0I7QUFHcEIsZ0JBQWdCLElBQWEsRUFBRSxPQUFnQjtJQUM3QyxJQUFJLENBQUMsSUFBSSxFQUFFO1FBQ1QsSUFBSSxHQUFHLE9BQU8sQ0FBQztLQUNoQjtJQUNELElBQUksQ0FBQyxPQUFPLEVBQUU7UUFDWixPQUFPLEdBQUcsYUFBYSxDQUFDO0tBQ3pCO0lBRUQsT0FBTztRQUNMLElBQUksRUFBRSxnQkFBUyxDQUFDLElBQUksQ0FBQztRQUNyQixPQUFPLEVBQUUsTUFBTSxDQUFDLElBQUksQ0FBQyxPQUFPLENBQUM7S0FDOUIsQ0FBQztBQUNKLENBQUM7QUFHRCxRQUFRLENBQUMsbUJBQW1CLEVBQUUsR0FBRyxFQUFFO0lBQ2pDLDRCQUE0QixJQUFZLEVBQUUsT0FBVztRQUNuRCxNQUFNLFFBQVEsR0FBRyw0QkFBaUIsQ0FBQyxPQUFPLENBQUMsQ0FBQyxNQUFNLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQztRQUMxRCxJQUFJLFFBQVEsRUFBRTtZQUNaLE9BQU8sUUFBUSxDQUFDLElBQUksQ0FBQztTQUN0QjthQUFNO1lBQ0wsT0FBTyxJQUFJLENBQUM7U0FDYjtJQUNILENBQUM7SUFFRCxFQUFFLENBQUMsT0FBTyxFQUFFLEdBQUcsRUFBRTtRQUNmLE1BQU0sQ0FBQyxrQkFBa0IsQ0FBQyxVQUFVLEVBQUUsRUFBRSxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUMsVUFBVSxDQUFDLENBQUM7UUFDNUQsTUFBTSxDQUFDLGtCQUFrQixDQUFDLGNBQWMsRUFBRSxFQUFFLENBQUMsRUFBRSxDQUFD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biAqIEBsaWNlbnNlXG4gKiBDb3B5cmlnaHQgR29vZ2xlIEluYy4gQWxsIFJpZ2h0cyBSZXNlcnZlZC5cbiAqXG4gKiBVc2Ugb2YgdGhpcyBzb3VyY2UgY29kZSBpcyBnb3Zlcm5lZCBieSBhbiBNSVQtc3R5bGUgbGljZW5zZSB0aGF0IGNhbiBiZVxuICogZm91bmQgaW4gdGhlIExJQ0VOU0UgZmlsZSBhdCBodHRwczovL2FuZ3VsYXIuaW8vbGljZW5zZVxuICovXG5pbXBvcnQgeyBub3JtYWxpemUgfSBmcm9tICdAYW5ndWxhci1kZXZraXQvY29yZSc7XG5pbXBvcnQgeyBGaWxlRW50cnkgfSBmcm9tICcuLi90cmVlL2ludGVyZmFjZSc7XG5pbXBvcnQge1xuICBJbnZhbGlkUGlwZUV4Y2VwdGlvbixcbiAgT3B0aW9uSXNOb3REZWZpbmVkRXhjZXB0aW9uLFxuICBVbmtub3duUGlwZUV4Y2VwdGlvbixcbiAgYXBwbHlDb250ZW50VGVtcGxhdGUsXG4gIGFwcGx5UGF0aFRlbXBsYXRlLFxufSBmcm9tICcuL3RlbXBsYXRlJztcblxuXG5mdW5jdGlvbiBfZW50cnkocGF0aD86IHN0cmluZywgY29udGVudD86IHN0cmluZyk6IEZpbGVFbnRyeSB7XG4gIGlmICghcGF0aCkge1xuICAgIHBhdGggPSAnYS9iL2MnO1xuICB9XG4gIGlmICghY29udGVudCkge1xuICAgIGNvbnRlbnQgPSAnaGVsbG8gd29ybGQnO1xuICB9XG5cbiAgcmV0dXJuIHtcbiAgICBwYXRoOiBub3JtYWxpemUocGF0aCksXG4gICAgY29udGVudDogQnVmZmVyLmZyb20oY29udGVudCksXG4gIH07XG59XG5cblxuZGVzY3JpYmUoJ2FwcGx5UGF0aFRlbXBsYXRlJywgKCkgPT4ge1xuICBmdW5jdGlvbiBfYXBwbHlQYXRoVGVtcGxhdGUocGF0aDogc3RyaW5nLCBvcHRpb25zOiB7fSk6IHN0cmluZyB8IG51bGwge1xuICAgIGNvbnN0IG5ld0VudHJ5ID0gYXBwbHlQYXRoVGVtcGxhdGUob3B0aW9ucykoX2VudHJ5KHBhdGgpKTtcbiAgICBpZiAobmV3RW50cnkpIHtcbiAgICAgIHJldHVybiBuZXdFbnRyeS5wYXRoO1xuICAgIH0gZWxzZSB7XG4gICAgICByZXR1cm4gbnVsbDtcbiAgICB9XG4gIH1cblxuICBpdCgnd29ya3MnLCAoKSA9PiB7XG4gICAgZXhwZWN0KF9hcHBseVBhdGhUZW1wbGF0ZSgnL2EvYi9jL2QnLCB7fSkpLnRvQmUoJy9hL2IvYy9kJyk7XG4gICAgZXhwZWN0KF9hcHBseVBhdGhUZW1wbGF0ZSgnL2EvYi9fX2NfXy9kJywgeyBjOiAxIH0pKS50b0JlKCcvYS9iLzEvZCcpO1xuICAgIGV4cGVjdChfYXBwbHlQYXRoVGVtcGxhdGUoJy9hL2IvX19jX18vZCcsIHsgYzogJ2hlbGxvL3dvcmxkJyB9KSkudG9CZSgnL2EvYi9oZWxsby93b3JsZC9kJyk7XG4gICAgZXhwZWN0KF9hcHBseVBhdGhUZW1wbGF0ZSgnL2FfX2NfX2InLCB7IGM6ICdoZWxsby93b3JsZCcgfSkpLnRvQmUoJy9haGVsbG8vd29ybGRiJyk7XG4gICAgZXhwZWN0KF9hcHBseVBhdGhUZW1wbGF0ZSgnL2FfX2NfX2JfX2RfX2MnLCB7IGM6ICcxJywgZDogJzInIH0pKS50b0JlKCcvYTFiMmMnKTtcbiAgfSk7XG5cbiAgaXQoJ3dvcmtzIHdpdGggc2luZ2xlIF8nLCAoKSA9PiB7XG4gICAgZXhwZWN0KF9hcHBseVBhdGhUZW1wbGF0ZSgnL2FfYl9jL2RfX2VfZl9fZycsIHsgZV9mOiAxIH0pKS50b0JlKCcvYV9iX2MvZDFnJyk7XG4gIH0pO1xuXG4gIGl0KCd3b3JrcyB3aXRoIGZ1bmN0aW9ucycsICgpID0+IHtcbiAgICBsZXQgYXJnID0gJyc7XG4gICAgZXhwZWN0KF9hcHBseVBhdGhUZW1wbGF0ZSgnL2FfX2NfX2InLCB7XG4gICAgICBjOiAoeDogc3RyaW5nKSA9PiAoYXJnID0geCwgJ2hlbGxvJyksXG4gICAgfSkpLnRvQmUoJy9haGVsbG9iJyk7XG4gICAgZXhwZWN0KGFyZykudG9CZSgnL2FfX2NfX2InKTtcbiAgfSk7XG5cbiAgaXQoJ3dvcmtzIHdpdGggcGlwZXMnLCAoKSA9PiB7XG4gICAgbGV0IGNhbGxlZCA9ICcnO1xuICAgIGxldCBjYWxsZWQyID0gJyc7XG5cbiAgICBleHBlY3QoX2FwcGx5UGF0aFRlbXBsYXRlKCcvYV9fY0BkX19iJywge1xuICAgICAgYzogMSxcbiAgICAgIGQ6ICh4OiBzdHJpbmcpID0+IChjYWxsZWQgPSB4LCAyKSxcbiAgICB9KSkudG9CZSgnL2EyYicpO1xuICAgIGV4cGVjdChjYWxsZWQpLnRvQmUoJzEnKTtcblxuICAgIGV4cGVjdChfYXBwbHlQYXRoVGVtcGxhdGUoJy9hX19jQGRAZV9fYicsIHtcbiAgICAgIGM6IDEwLFxuICAgICAgZDogKHg6IHN0cmluZykgPT4gKGNhbGxlZCA9IHgsIDIwKSxcbiAgICAgIGU6ICh4OiBzdHJpbmcpID0+IChjYWxsZWQyID0geCwgMzApLFxuICAgIH0pKS50b0JlKCcvYTMwYicpO1xuICAgIGV4cGVjdChjYWxsZWQpLnRvQmUoJzEwJyk7XG4gICAgZXhwZWN0KGNhbGxlZDIpLnRvQmUoJzIwJyk7XG4gIH0pO1xuXG4gIGl0KCdlcnJvcnMgb3V0IG9uIHVuZGVmaW5lZCB2YWx1ZXMnLCAoKSA9PiB7XG4gICAgZXhwZWN0KCgpID0+IF9hcHBseVBhdGhUZW1wbGF0ZSgnL2FfX2JfX2MnLCB7fSkpLnRvVGhyb3cobmV3IE9wdGlvbklzTm90RGVmaW5lZEV4Y2VwdGlvbignYicpKTtcbiAgfSk7XG5cbiAgaXQoJ2Vycm9ycyBvdXQgb24gdW5kZWZpbmVkIG9yIGludmFsaWQgcGlwZXMnLCAoKSA9PiB7XG4gICAgZXhwZWN0KCgpID0+IF9hcHBseVBhdGhUZW1wbGF0ZSgnL2FfX2JAZF9fYycsIHsgYjogMSB9KSkudG9UaHJvdyhuZXcgVW5rbm93blBpcGVFeGNlcHRpb24oJ2QnKSk7XG4gICAgZXhwZWN0KCgpID0+IF9hcHBseVBhdGhUZW1wbGF0ZSgnL2FfX2JAZF9fYycsIHsgYjogMSwgZDogMSB9KSlcbiAgICAgIC50b1Rocm93KG5ldyBJbnZhbGlkUGlwZUV4Y2VwdGlvbignZCcpKTtcbiAgfSk7XG59KTtcblxuXG5kZXNjcmliZSgnY29udGVudFRlbXBsYXRlJywgKCkgPT4ge1xuICBmdW5jdGlvbiBfYXBwbHlDb250ZW50VGVtcGxhdGUoY29udGVudDogc3RyaW5nLCBvcHRpb25zOiB7fSkge1xuICAgIGNvbnN0IG5ld0VudHJ5ID0gYXBwbHlDb250ZW50VGVtcGxhdGUob3B0aW9ucykoX2VudHJ5KCcnLCBjb250ZW50KSk7XG4gICAgaWYgKG5ld0VudHJ5KSB7XG4gICAgICByZXR1cm4gbmV3RW50cnkuY29udGVudC50b1N0cmluZygndXRmLTgnKTtcbiAgICB9IGVsc2Uge1xuICAgICAgcmV0dXJuIG51bGw7XG4gICAgfVxuICB9XG5cbiAgaXQoJ3dvcmtzIHdpdGggZWNobyB0b2tlbiA8JT0gLi4uICU+JywgKCkgPT4ge1xuICAgIGV4cGVjdChfYXBwbHlDb250ZW50VGVtcGxhdGUoJ2E8JT0gdmFsdWUgJT5iJywgeyB2YWx1ZTogMTIzIH0pKS50b0JlKCdhMTIzYicpO1xuICB9KTtcblxuICBpdCgnd29ya3Mgd2l0aCBpZicsICgpID0+IHtcbiAgICBleHBlY3QoX2FwcGx5Q29udGVudFRlbXBsYXRlKCdhPCUgaWYgKGEpIHsgJT5iPCUgfSAlPmMnLCB7XG4gICAgICB2YWx1ZTogMTIzLFxuICAgICAgYTogdHJ1ZSxcbiAgICB9KSkudG9CZSgnYWJjJyk7XG4gICAgZXhwZWN0KF9hcHBseUNvbnRlbnRUZW1wbGF0ZSgnYTwlIGlmIChhKSB7ICU+YjwlIH0gJT5jJywge1xuICAgICAgdmFsdWU6IDEyMyxcbiAgICAgIGE6IGZhbHNlLFxuICAgIH0pKS50b0JlKCdhYycpO1xuICB9KTtcblxuICBpdCgnd29ya3Mgd2l0aCBmb3InLCAoKSA9PiB7XG4gICAgZXhwZWN0KF9hcHBseUNvbnRlbnRUZW1wbGF0ZSgnYTwlIGZvciAobGV0IGkgPSAwOyBpIDwgdmFsdWU7IGkrKykgeyAlPjE8JSB9ICU+YicsIHtcbiAgICAgIHZhbHVlOiA1LFxuICAgIH0pKS50b0JlKCdhMTExMTFiJyk7XG4gIH0pO1xuXG4gIGl0KCdlc2NhcGVzIEhUTUwnLCAoKSA9PiB7XG4gICAgZXhwZWN0KF9hcHBseUNvbnRlbnRUZW1wbGF0ZSgnYTwlLSBodG1sICU+YicsIHtcbiAgICAgIGh0bWw6ICc8c2NyaXB0PicsXG4gICAgfSkpLnRvQmUoJ2EmbHQ7c2NyaXB0Jmd0O2InKTtcbiAgfSk7XG5cbiAgaXQoJ2VzY2FwZXMgc3RyaW5ncyBwcm9wZXJseScsICgpID0+IHtcbiAgICBleHBlY3QoX2FwcGx5Q29udGVudFRlbXBsYXRlKCdhPCU9IHZhbHVlICU+YicsIHsgdmFsdWU6IGAnYWJjJ2AgfSkpLnRvQmUoJ2FcXCdhYmNcXCdiJyk7XG4gICAgZXhwZWN0KF9hcHBseUNvbnRlbnRUZW1wbGF0ZSgnYTwlPSBcXCdhXFwnICsgXCJiXCIgJT5iJywge30pKS50b0JlKCdhYWJiJyk7XG4gICAgZXhwZWN0KF9hcHBseUNvbnRlbnRUZW1wbGF0ZSgnYTwlPSBcIlxcXFxuXCIgKyBcImJcIiAlPmInLCB7fSkpLnRvQmUoJ2FcXG5iYicpO1xuICB9KTtcbn0pO1xuIl19