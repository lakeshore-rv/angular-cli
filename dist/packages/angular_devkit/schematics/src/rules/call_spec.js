"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
/**
 * @license
 * Copyright Google Inc. All Rights Reserved.
 *
 * Use of this source code is governed by an MIT-style license that can be
 * found in the LICENSE file at https://angular.io/license
 */
// tslint:disable:non-null-operator
// tslint:disable:no-any
// tslint:disable:no-implicit-dependencies
const schematics_1 = require("@angular-devkit/schematics");
const rxjs_1 = require("rxjs");
const static_1 = require("../tree/static");
const call_1 = require("./call");
const context = {
    engine: null,
    debug: false,
    strategy: schematics_1.MergeStrategy.Default,
};
describe('callSource', () => {
    it('errors if undefined source', done => {
        const source0 = () => undefined;
        call_1.callSource(source0, context)
            .toPromise()
            .then(() => done.fail(), err => {
            expect(err.constructor).toBe(call_1.InvalidSourceResultException);
        })
            .then(done, done.fail);
    });
    it('errors if invalid source object', done => {
        const source0 = () => ({});
        call_1.callSource(source0, context)
            .toPromise()
            .then(() => done.fail(), err => {
            expect(err.constructor).toBe(call_1.InvalidSourceResultException);
        })
            .then(done, done.fail);
    });
    it('errors if Observable of invalid source object', done => {
        const source0 = () => rxjs_1.of({});
        call_1.callSource(source0, context)
            .toPromise()
            .then(() => done.fail(), err => {
            expect(err.constructor).toBe(call_1.InvalidSourceResultException);
        })
            .then(done, done.fail);
    });
    it('works with a Tree', done => {
        const tree0 = static_1.empty();
        const source0 = () => tree0;
        call_1.callSource(source0, context)
            .toPromise()
            .then(tree => {
            expect(tree).toBe(tree0);
        })
            .then(done, done.fail);
    });
    it('works with an Observable', done => {
        const tree0 = static_1.empty();
        const source0 = () => rxjs_1.of(tree0);
        call_1.callSource(source0, context)
            .toPromise()
            .then(tree => {
            expect(tree).toBe(tree0);
        })
            .then(done, done.fail);
    });
});
describe('callRule', () => {
    it('errors if invalid source object', done => {
        const tree0 = rxjs_1.of(static_1.empty());
        const rule0 = () => ({});
        call_1.callRule(rule0, tree0, context)
            .toPromise()
            .then(() => done.fail(), err => {
            expect(err.constructor).toBe(call_1.InvalidRuleResultException);
        })
            .then(done, done.fail);
    });
    it('errors if Observable of invalid source object', done => {
        const tree0 = rxjs_1.of(static_1.empty());
        const rule0 = () => rxjs_1.of({});
        call_1.callRule(rule0, tree0, context)
            .toPromise()
            .then(() => done.fail(), err => {
            expect(err.constructor).toBe(call_1.InvalidRuleResultException);
        })
            .then(done, done.fail);
    });
    it('works with undefined result', done => {
        const tree0 = static_1.empty();
        const rule0 = () => undefined;
        call_1.callRule(rule0, rxjs_1.of(tree0), context)
            .toPromise()
            .then(tree => {
            expect(tree).toBe(tree0);
        })
            .then(done, done.fail);
    });
    it('works with a Tree', done => {
        const tree0 = static_1.empty();
        const rule0 = () => tree0;
        call_1.callRule(rule0, rxjs_1.of(tree0), context)
            .toPromise()
            .then(tree => {
            expect(tree).toBe(tree0);
        })
            .then(done, done.fail);
    });
    it('works with an Observable', done => {
        const tree0 = static_1.empty();
        const rule0 = () => rxjs_1.of(tree0);
        call_1.callRule(rule0, rxjs_1.of(tree0), context)
            .toPromise()
            .then(tree => {
            expect(tree).toBe(tree0);
        })
            .then(done, done.fail);
    });
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY2FsbF9zcGVjLmpzIiwic291cmNlUm9vdCI6Ii9Vc2Vycy9lcm5pZWRhdmlzL0NvZGUvYW5ndWxhci1jbGkvIiwic291cmNlcyI6WyJwYWNrYWdlcy9hbmd1bGFyX2RldmtpdC9zY2hlbWF0aWNzL3NyYy9ydWxlcy9jYWxsX3NwZWMudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7QUFBQTs7Ozs7O0dBTUc7QUFDSCxtQ0FBbUM7QUFDbkMsd0JBQXdCO0FBQ3hCLDBDQUEwQztBQUMxQywyREFBMkQ7QUFDM0QsK0JBQTBDO0FBRzFDLDJDQUF1QztBQUN2QyxpQ0FLZ0I7QUFHaEIsTUFBTSxPQUFPLEdBQXFCO0lBQ2hDLE1BQU0sRUFBRSxJQUFJO0lBQ1osS0FBSyxFQUFFLEtBQUs7SUFDWixRQUFRLEVBQUUsMEJBQWEsQ0FBQyxPQUFPO0NBQ04sQ0FBQztBQUc1QixRQUFRLENBQUMsWUFBWSxFQUFFLEdBQUcsRUFBRTtJQUMxQixFQUFFLENBQUMsNEJBQTRCLEVBQUUsSUFBSSxDQUFDLEVBQUU7UUFDdEMsTUFBTSxPQUFPLEdBQVEsR0FBRyxFQUFFLENBQUMsU0FBUyxDQUFDO1FBRXJDLGlCQUFVLENBQUMsT0FBTyxFQUFFLE9BQU8sQ0FBQzthQUN6QixTQUFTLEVBQUU7YUFDWCxJQUFJLENBQUMsR0FBRyxFQUFFLENBQUMsSUFBSSxDQUFDLElBQUksRUFBRSxFQUFFLEdBQUcsQ0FBQyxFQUFFO1lBQzdCLE1BQU0sQ0FBQyxHQUFHLENBQUMsV0FBVyxDQUFDLENBQUMsSUFBSSxDQUFDLG1DQUE0QixDQUFDLENBQUM7UUFDN0QsQ0FBQyxDQUFDO2FBQ0QsSUFBSSxDQUFDLElBQUksRUFBRSxJQUFJLENBQUMsSUFBSSxDQUFDLENBQUM7SUFDM0IsQ0FBQyxDQUFDLENBQUM7SUFFSCxFQUFFLENBQUMsaUNBQWlDLEVBQUUsSUFBSSxDQUFDLEVBQUU7UUFDM0MsTUFBTSxPQUFPLEdBQVcsR0FBRyxFQUFFLENBQUMsQ0FBQyxFQUFXLENBQUEsQ0FBQztRQUUzQyxp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QUksQ0FBQyxFQUFFO1FBQzdCLE1BQU0sS0FBSyxHQUFHLGNBQUssRUFBRSxDQUFDO1FBQ3RCLE1BQU0sS0FBSyxHQUFTLEdBQUcsRUFBRSxDQUFDLEtBQUssQ0FBQztRQUVoQyxlQUFRLENBQUMsS0FBSyxFQUFFLFNBQVksQ0FBQyxLQUFLLENBQUMsRUFBRSxPQUFPLENBQUM7YUFDMUMsU0FBUyxFQUFFO2FBQ1gsSUFBSSxDQUFDLElBQUksQ0FBQyxFQUFFO1lBQ1gsTUFBTSxDQUFDLElBQUksQ0FBQyxDQUFDLElBQUksQ0FBQyxLQUFLLENBQUMsQ0FBQztRQUMzQixDQUFDLENBQUM7YUFDRCxJQUFJLENBQUMsSUFBSSxFQUFFLElBQUksQ0FBQyxJQUFJLENBQUMsQ0FBQztJQUMzQixDQUFDLENBQUMsQ0FBQztJQUVILEVBQUUsQ0FBQywwQkFBMEIsRUFBRSxJQUFJLENBQUMsRUFBRTtRQUNwQyxNQUFNLEtBQUssR0FBRyxjQUFLLEVBQUUsQ0FBQztRQUN0QixNQUFNLEtBQUssR0FBUyxHQUFHLEVBQUUsQ0FBQyxTQUFZLENBQUMsS0FBSyxDQUFDLENBQUM7UUFFOUMsZUFBUSxDQUFDLEtBQUssRUFBRSxTQUFZLENBQUMsS0FBSyxDQUFDLEVBQUUsT0FBTyxDQUFDO2FBQzFDLFNBQVMsRUFBRTthQUNYLElBQUksQ0FBQyxJQUFJLENBQUMsRUFBRTtZQUNYLE1BQU0sQ0FBQyxJQUFJLENBQUMsQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDLENBQUM7UUFDM0IsQ0FBQyxDQUFDO2FBQ0QsSUFBSSxDQUFDLElBQUksRUFBRSxJQUFJLENBQUMsSUFBSSxDQUFDLENBQUM7SUFDM0IsQ0FBQyxDQUFDLENBQUM7QUFDTCxDQUFDLENBQUMsQ0FBQyIsInNvdXJjZXNDb250ZW50IjpbIi8qKlxuICogQGxpY2Vuc2VcbiAqIENvcHlyaWdodCBHb29nbGUgSW5jLiBBbGwgUmlnaHRzIFJlc2VydmVkLlxuICpcbiAqIFVzZSBvZiB0aGlzIHNvdXJjZSBjb2RlIGlzIGdvdmVybmVkIGJ5IGFuIE1JVC1zdHlsZSBsaWNlbnNlIHRoYXQgY2FuIGJlXG4gKiBmb3VuZCBpbiB0aGUgTElDRU5TRSBmaWxlIGF0IGh0dHBzOi8vYW5ndWxhci5pby9saWNlbnNlXG4gKi9cbi8vIHRzbGludDpkaXNhYmxlOm5vbi1udWxsLW9wZXJhdG9yXG4vLyB0c2xpbnQ6ZGlzYWJsZTpuby1hbnlcbi8vIHRzbGludDpkaXNhYmxlOm5vLWltcGxpY2l0LWRlcGVuZGVuY2llc1xuaW1wb3J0IHsgTWVyZ2VTdHJhdGVneSB9IGZyb20gJ0Bhbmd1bGFyLWRldmtpdC9zY2hlbWF0aWNzJztcbmltcG9ydCB7IG9mIGFzIG9ic2VydmFibGVPZiB9IGZyb20gJ3J4anMnO1xuaW1wb3J0IHsgUnVsZSwgU2NoZW1hdGljQ29udGV4dCwgU291cmNlIH0gZnJvbSAnLi4vZW5naW5lL2ludGVyZmFjZSc7XG5pbXBvcnQgeyBUcmVlIH0gZnJvbSAnLi4vdHJlZS9pbnRlcmZhY2UnO1xuaW1wb3J0IHsgZW1wdHkgfSBmcm9tICcuLi90cmVlL3N0YXRpYyc7XG5pbXBvcnQge1xuICBJbnZhbGlkUnVsZVJlc3VsdEV4Y2VwdGlvbixcbiAgSW52YWxpZFNvdXJjZVJlc3VsdEV4Y2VwdGlvbixcbiAgY2FsbFJ1bGUsXG4gIGNhbGxTb3VyY2UsXG59IGZyb20gJy4vY2FsbCc7XG5cblxuY29uc3QgY29udGV4dDogU2NoZW1hdGljQ29udGV4dCA9IHtcbiAgZW5naW5lOiBudWxsLFxuICBkZWJ1ZzogZmFsc2UsXG4gIHN0cmF0ZWd5OiBNZXJnZVN0cmF0ZWd5LkRlZmF1bHQsXG59IGFzIHt9IGFzIFNjaGVtYXRpY0NvbnRleHQ7XG5cblxuZGVzY3JpYmUoJ2NhbGxTb3VyY2UnLCAoKSA9PiB7XG4gIGl0KCdlcnJvcnMgaWYgdW5kZWZpbmVkIHNvdXJjZScsIGRvbmUgPT4ge1xuICAgIGNvbnN0IHNvdXJjZTA6IGFueSA9ICgpID0+IHVuZGVmaW5lZDtcblxuICAgIGNhbGxTb3VyY2Uoc291cmNlMCwgY29udGV4dClcbiAgICAgIC50b1Byb21pc2UoKVxuICAgICAgLnRoZW4oKCkgPT4gZG9uZS5mYWlsKCksIGVyciA9PiB7XG4gICAgICAgIGV4cGVjdChlcnIuY29uc3RydWN0b3IpLnRvQmUoSW52YWxpZFNvdXJjZVJlc3VsdEV4Y2VwdGlvbik7XG4gICAgICB9KVxuICAgICAgLnRoZW4oZG9uZSwgZG9uZS5mYWlsKTtcbiAgfSk7XG5cbiAgaXQoJ2Vycm9ycyBpZiBpbnZhbGlkIHNvdXJjZSBvYmplY3QnLCBkb25lID0+IHtcbiAgICBjb25zdCBzb3VyY2UwOiBTb3VyY2UgPSAoKSA9PiAoe30gYXMgVHJlZSk7XG5cbiAgICBjYWxsU291cmNlKHNvdXJjZTAsIGNvbnRleHQpXG4gICAgICAudG9Qcm9taXNlKClcbiAgICAgIC50aGVuKCgpID0+IGRvbmUuZmFpbCgpLCBlcnIgPT4ge1xuICAgICAgICBleHBlY3QoZXJyLmNvbnN0cnVjdG9yKS50b0JlKEludmFsaWRTb3VyY2VSZXN1bHRFeGNlcHRpb24pO1xuICAgICAgfSlcbiAgICAgIC50aGVuKGRvbmUsIGRvbmUuZmFpbCk7XG4gIH0pO1xuXG4gIGl0KCdlcnJvcnMgaWYgT2JzZXJ2YWJsZSBvZiBpbnZhbGlkIHNvdXJjZSBvYmplY3QnLCBkb25lID0+IHtcbiAgICBjb25zdCBzb3VyY2UwOiBTb3VyY2UgPSAoKSA9PiBvYnNlcnZhYmxlT2Yoe30gYXMgVHJlZSk7XG5cbiAgICBjYWxsU291cmNlKHNvdXJjZTAsIGNvbnRleHQpXG4gICAgICAudG9Qcm9taXNlKClcbiAgICAgIC50aGVuKCgpID0+IGRvbmUuZmFpbCgpLCBlcnIgPT4ge1xuICAgICAgICBleHBlY3QoZXJyLmNvbnN0cnVjdG9yKS50b0JlKEludmFsaWRTb3VyY2VSZXN1bHRFeGNlcHRpb24pO1xuICAgICAgfSlcbiAgICAgIC50aGVuKGRvbmUsIGRvbmUuZmFpbCk7XG4gIH0pO1xuXG4gIGl0KCd3b3JrcyB3aXRoIGEgVHJlZScsIGRvbmUgPT4ge1xuICAgIGNvbnN0IHRyZWUwID0gZW1wdHkoKTtcbiAgICBjb25zdCBzb3VyY2UwOiBTb3VyY2UgPSAoKSA9PiB0cmVlMDtcblxuICAgIGNhbGxTb3VyY2Uoc291cmNlMCwgY29udGV4dClcbiAgICAgIC50b1Byb21pc2UoKVxuICAgICAgLnRoZW4odHJlZSA9PiB7XG4gICAgICAgIGV4cGVjdCh0cmVlKS50b0JlKHRyZWUwKTtcbiAgICAgIH0pXG4gICAgICAudGhlbihkb25lLCBkb25lLmZhaWwpO1xuICB9KTtcblxuICBpdCgnd29ya3Mgd2l0aCBhbiBPYnNlcnZhYmxlJywgZG9uZSA9PiB7XG4gICAgY29uc3QgdHJlZTAgPSBlbXB0eSgpO1xuICAgIGNvbnN0IHNvdXJjZTA6IFNvdXJjZSA9ICgpID0+IG9ic2VydmFibGVPZih0cmVlMCk7XG5cbiAgICBjYWxsU291cmNlKHNvdXJjZTAsIGNvbnRleHQpXG4gICAgICAudG9Qcm9taXNlKClcbiAgICAgIC50aGVuKHRyZWUgPT4ge1xuICAgICAgICBleHBlY3QodHJlZSkudG9CZSh0cmVlMCk7XG4gICAgICB9KVxuICAgICAgLnRoZW4oZG9uZSwgZG9uZS5mYWlsKTtcbiAgfSk7XG59KTtcblxuZGVzY3JpYmUoJ2NhbGxSdWxlJywgKCkgPT4ge1xuICBpdCgnZXJyb3JzIGlmIGludmFsaWQgc291cmNlIG9iamVjdCcsIGRvbmUgPT4ge1xuICAgIGNvbnN0IHRyZWUwID0gb2JzZXJ2YWJsZU9mKGVtcHR5KCkpO1xuICAgIGNvbnN0IHJ1bGUwOiBSdWxlID0gKCkgPT4gKHt9IGFzIFRyZWUpO1xuXG4gICAgY2FsbFJ1bGUocnVsZTAsIHRyZWUwLCBjb250ZXh0KVxuICAgICAgLnRvUHJvbWlzZSgpXG4gICAgICAudGhlbigoKSA9PiBkb25lLmZhaWwoKSwgZXJyID0+IHtcbiAgICAgICAgZXhwZWN0KGVyci5jb25zdHJ1Y3RvcikudG9CZShJbnZhbGlkUnVsZVJlc3VsdEV4Y2VwdGlvbik7XG4gICAgICB9KVxuICAgICAgLnRoZW4oZG9uZSwgZG9uZS5mYWlsKTtcbiAgfSk7XG5cbiAgaXQoJ2Vycm9ycyBpZiBPYnNlcnZhYmxlIG9mIGludmFsaWQgc291cmNlIG9iamVjdCcsIGRvbmUgPT4ge1xuICAgIGNvbnN0IHRyZWUwID0gb2JzZXJ2YWJsZU9mKGVtcHR5KCkpO1xuICAgIGNvbnN0IHJ1bGUwOiBSdWxlID0gKCkgPT4gb2JzZXJ2YWJsZU9mKHt9IGFzIFRyZWUpO1xuXG4gICAgY2FsbFJ1bGUocnVsZTAsIHRyZWUwLCBjb250ZXh0KVxuICAgICAgLnRvUHJvbWlzZSgpXG4gICAgICAudGhlbigoKSA9PiBkb25lLmZhaWwoKSwgZXJyID0+IHtcbiAgICAgICAgZXhwZWN0KGVyci5jb25zdHJ1Y3RvcikudG9CZShJbnZhbGlkUnVsZVJlc3VsdEV4Y2VwdGlvbik7XG4gICAgICB9KVxuICAgICAgLnRoZW4oZG9uZSwgZG9uZS5mYWlsKTtcbiAgfSk7XG5cbiAgaXQoJ3dvcmtzIHdpdGggdW5kZWZpbmVkIHJlc3VsdCcsIGRvbmUgPT4ge1xuICAgIGNvbnN0IHRyZWUwID0gZW1wdHkoKTtcbiAgICBjb25zdCBydWxlMDogUnVsZSA9ICgpID0+IHVuZGVmaW5lZDtcblxuICAgIGNhbGxSdWxlKHJ1bGUwLCBvYnNlcnZhYmxlT2YodHJlZTApLCBjb250ZXh0KVxuICAgICAgLnRvUHJvbWlzZSgpXG4gICAgICAudGhlbih0cmVlID0+IHtcbiAgICAgICAgZXhwZWN0KHRyZWUpLnRvQmUodHJlZTApO1xuICAgICAgfSlcbiAgICAgIC50aGVuKGRvbmUsIGRvbmUuZmFpbCk7XG4gIH0pO1xuXG4gIGl0KCd3b3JrcyB3aXRoIGEgVHJlZScsIGRvbmUgPT4ge1xuICAgIGNvbnN0IHRyZWUwID0gZW1wdHkoKTtcbiAgICBjb25zdCBydWxlMDogUnVsZSA9ICgpID0+IHRyZWUwO1xuXG4gICAgY2FsbFJ1bGUocnVsZTAsIG9ic2VydmFibGVPZih0cmVlMCksIGNvbnRleHQpXG4gICAgICAudG9Qcm9taXNlKClcbiAgICAgIC50aGVuKHRyZWUgPT4ge1xuICAgICAgICBleHBlY3QodHJlZSkudG9CZSh0cmVlMCk7XG4gICAgICB9KVxuICAgICAgLnRoZW4oZG9uZSwgZG9uZS5mYWlsKTtcbiAgfSk7XG5cbiAgaXQoJ3dvcmtzIHdpdGggYW4gT2JzZXJ2YWJsZScsIGRvbmUgPT4ge1xuICAgIGNvbnN0IHRyZWUwID0gZW1wdHkoKTtcbiAgICBjb25zdCBydWxlMDogUnVsZSA9ICgpID0+IG9ic2VydmFibGVPZih0cmVlMCk7XG5cbiAgICBjYWxsUnVsZShydWxlMCwgb2JzZXJ2YWJsZU9mKHRyZWUwKSwgY29udGV4dClcbiAgICAgIC50b1Byb21pc2UoKVxuICAgICAgLnRoZW4odHJlZSA9PiB7XG4gICAgICAgIGV4cGVjdCh0cmVlKS50b0JlKHRyZWUwKTtcbiAgICAgIH0pXG4gICAgICAudGhlbihkb25lLCBkb25lLmZhaWwpO1xuICB9KTtcbn0pO1xuIl19