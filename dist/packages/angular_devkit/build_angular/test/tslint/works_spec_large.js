"use strict";
/**
 * @license
 * Copyright Google Inc. All Rights Reserved.
 *
 * Use of this source code is governed by an MIT-style license that can be
 * found in the LICENSE file at https://angular.io/license
 */
Object.defineProperty(exports, "__esModule", { value: true });
const testing_1 = require("@angular-devkit/architect/testing");
const core_1 = require("@angular-devkit/core");
const operators_1 = require("rxjs/operators");
const utils_1 = require("../utils");
describe('Tslint Target', () => {
    const filesWithErrors = { 'src/foo.ts': 'const foo = "";\n' };
    beforeEach(done => utils_1.host.initialize().toPromise().then(done, done.fail));
    afterEach(done => utils_1.host.restore().toPromise().then(done, done.fail));
    it('works', (done) => {
        testing_1.runTargetSpec(utils_1.host, utils_1.tslintTargetSpec).pipe(operators_1.tap((buildEvent) => expect(buildEvent.success).toBe(true))).toPromise().then(done, done.fail);
    }, 30000);
    it('should report lint error once', (done) => {
        utils_1.host.writeMultipleFiles({ 'src/app/app.component.ts': 'const foo = "";\n' });
        const logger = new testing_1.TestLogger('lint-error');
        testing_1.runTargetSpec(utils_1.host, utils_1.tslintTargetSpec, undefined, testing_1.DefaultTimeout, logger).pipe(operators_1.tap((buildEvent) => expect(buildEvent.success).toBe(false)), operators_1.tap(() => {
            // this is to make sure there are no duplicates
            expect(logger.includes(`" should be \'\nERROR`)).toBe(false);
            expect(logger.includes(`" should be '`)).toBe(true);
            expect(logger.includes(`Lint errors found in the listed files`)).toBe(true);
        })).toPromise().then(done, done.fail);
    }, 30000);
    it('supports exclude', (done) => {
        utils_1.host.writeMultipleFiles(filesWithErrors);
        const overrides = { exclude: ['**/foo.ts'] };
        testing_1.runTargetSpec(utils_1.host, utils_1.tslintTargetSpec, overrides).pipe(operators_1.tap((buildEvent) => expect(buildEvent.success).toBe(true))).toPromise().then(done, done.fail);
    }, 30000);
    it('supports fix', (done) => {
        utils_1.host.writeMultipleFiles(filesWithErrors);
        const overrides = { fix: true };
        testing_1.runTargetSpec(utils_1.host, utils_1.tslintTargetSpec, overrides).pipe(operators_1.tap((buildEvent) => expect(buildEvent.success).toBe(true)), operators_1.tap(() => {
            const fileName = core_1.normalize('src/foo.ts');
            const content = core_1.virtualFs.fileBufferToString(utils_1.host.scopedSync().read(fileName));
            expect(content).toContain(`const foo = '';`);
        })).toPromise().then(done, done.fail);
    }, 30000);
    it('supports force', (done) => {
        utils_1.host.writeMultipleFiles(filesWithErrors);
        const logger = new testing_1.TestLogger('lint-force');
        const overrides = { force: true };
        testing_1.runTargetSpec(utils_1.host, utils_1.tslintTargetSpec, overrides, testing_1.DefaultTimeout, logger).pipe(operators_1.tap((buildEvent) => expect(buildEvent.success).toBe(true)), operators_1.tap(() => {
            expect(logger.includes(`" should be '`)).toBe(true);
            expect(logger.includes(`Lint errors found in the listed files`)).toBe(true);
        })).toPromise().then(done, done.fail);
    }, 30000);
    it('supports format', (done) => {
        utils_1.host.writeMultipleFiles(filesWithErrors);
        const logger = new testing_1.TestLogger('lint-format');
        const overrides = { format: 'stylish' };
        testing_1.runTargetSpec(utils_1.host, utils_1.tslintTargetSpec, overrides, testing_1.DefaultTimeout, logger).pipe(operators_1.tap((buildEvent) => expect(buildEvent.success).toBe(false)), operators_1.tap(() => {
            expect(logger.includes(`quotemark`)).toBe(true);
        })).toPromise().then(done, done.fail);
    }, 30000);
    it('supports finding configs', (done) => {
        utils_1.host.writeMultipleFiles({
            'src/app/foo/foo.ts': `const foo = '';\n`,
            'src/app/foo/tslint.json': `
        {
          "rules": {
            "quotemark": [
              true,
              "double"
            ]
          }
        }
      `,
        });
        const overrides = { tslintConfig: undefined };
        testing_1.runTargetSpec(utils_1.host, utils_1.tslintTargetSpec, overrides).pipe(operators_1.tap((buildEvent) => expect(buildEvent.success).toBe(false))).toPromise().then(done, done.fail);
    }, 30000);
    it('supports overriding configs', (done) => {
        utils_1.host.writeMultipleFiles({
            'src/app/foo/foo.ts': `const foo = '';\n`,
            'src/app/foo/tslint.json': `
        {
          "rules": {
            "quotemark": [
              true,
              "double"
            ]
          }
        }
      `,
        });
        const overrides = { tslintConfig: 'tslint.json' };
        testing_1.runTargetSpec(utils_1.host, utils_1.tslintTargetSpec, overrides).pipe(operators_1.tap((buildEvent) => expect(buildEvent.success).toBe(true))).toPromise().then(done, done.fail);
    }, 30000);
    it('supports using files with no project', (done) => {
        const overrides = {
            tsConfig: undefined,
            files: ['src/app/**/*.ts'],
        };
        testing_1.runTargetSpec(utils_1.host, utils_1.tslintTargetSpec, overrides).pipe(operators_1.tap((buildEvent) => expect(buildEvent.success).toBe(true))).toPromise().then(done, done.fail);
    }, 30000);
    it('supports using one project as a string', (done) => {
        const overrides = {
            tsConfig: 'src/tsconfig.app.json',
        };
        testing_1.runTargetSpec(utils_1.host, utils_1.tslintTargetSpec, overrides).pipe(operators_1.tap((buildEvent) => expect(buildEvent.success).toBe(true))).toPromise().then(done, done.fail);
    }, 30000);
    it('supports using one project as an array', (done) => {
        const overrides = {
            tsConfig: ['src/tsconfig.app.json'],
        };
        testing_1.runTargetSpec(utils_1.host, utils_1.tslintTargetSpec, overrides).pipe(operators_1.tap((buildEvent) => expect(buildEvent.success).toBe(true))).toPromise().then(done, done.fail);
    }, 30000);
    it('supports using two projects', (done) => {
        const overrides = {
            tsConfig: ['src/tsconfig.app.json', 'src/tsconfig.spec.json'],
        };
        testing_1.runTargetSpec(utils_1.host, utils_1.tslintTargetSpec, overrides).pipe(operators_1.tap((buildEvent) => expect(buildEvent.success).toBe(true))).toPromise().then(done, done.fail);
    }, 30000);
    it('errors when type checking is used without a project', (done) => {
        const overrides = {
            tsConfig: undefined,
            typeCheck: true,
        };
        testing_1.runTargetSpec(utils_1.host, utils_1.tslintTargetSpec, overrides)
            .subscribe(undefined, () => done(), done.fail);
    }, 30000);
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoid29ya3Nfc3BlY19sYXJnZS5qcyIsInNvdXJjZVJvb3QiOiIvVXNlcnMvZXJuaWVkYXZpcy9Db2RlL2FuZ3VsYXItY2xpLyIsInNvdXJjZXMiOlsicGFja2FnZXMvYW5ndWxhcl9kZXZraXQvYnVpbGRfYW5ndWxhci90ZXN0L3RzbGludC93b3Jrc19zcGVjX2xhcmdlLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7QUFBQTs7Ozs7O0dBTUc7O0FBRUgsK0RBQThGO0FBQzlGLCtDQUE0RDtBQUM1RCw4Q0FBcUM7QUFFckMsb0NBQWtEO0FBR2xELFFBQVEsQ0FBQyxlQUFlLEVBQUUsR0FBRyxFQUFFO0lBQzdCLE1BQU0sZUFBZSxHQUFHLEVBQUUsWUFBWSxFQUFFLG1CQUFtQixFQUFFLENBQUM7SUFFOUQsVUFBVSxDQUFDLElBQUksQ0FBQyxFQUFFLENBQUMsWUFBSSxDQUFDLFVBQVUsRUFBRSxDQUFDLFNBQVMsRUFBRSxDQUFDLElBQUksQ0FBQyxJQUFJLEVBQUUsSUFBSSxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUM7SUFDeEUsU0FBUyxDQUFDLElBQUksQ0FBQyxFQUFFLENBQUMsWUFBSSxDQUFDLE9BQU8sRUFBRSxDQUFDLFNBQVMsRUFBRSxDQUFDLElBQUksQ0FBQyxJQUFJLEVBQUUsSUFBSSxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUM7SUFFcEUsRUFBRSxDQUFDLE9BQU8sRUFBRSxDQUFDLElBQUksRUFBRSxFQUFFO1FBQ25CLHVCQUFhLENBQUMsWUFBSSxFQUFFLHdCQUFnQixDQUFDLENBQUMsSUFBSSxDQUN4QyxlQUFHLENBQUMsQ0FBQyxVQUFVLEVBQUUsRUFBRSxDQUFDLE1BQU0sQ0FBQyxVQUFVLENBQUMsT0FBTyxDQUFDLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxDQUFDLENBQzNELENBQUMsU0FBUyxFQUFFLENBQUMsSUFBSSxDQUFDLElBQUksRUFBRSxJQUFJLENBQUMsSUFBSSxDQUFDLENBQUM7SUFDdEMsQ0FBQyxFQUFFLEtBQUssQ0FB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QyxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUMzRCxDQUFDLFNBQVMsRUFBRSxDQUFDLElBQUksQ0FBQyxJQUFJLEVBQUUsSUFBSSxDQUFDLElBQUksQ0FBQyxDQUFDO0lBQ3RDLENBQUMsRUFBRSxLQUFLLENBQUMsQ0FBQztJQUVWLEVBQUUsQ0FBQyxxREFBcUQsRUFBRSxDQUFDLElBQUksRUFBRSxFQUFFO1FBQ2pFLE1BQU0sU0FBUyxHQUFrQztZQUMvQyxRQUFRLEVBQUUsU0FBUztZQUNuQixTQUFTLEVBQUUsSUFBSTtTQUNoQixDQUFDO1FBRUYsdUJBQWEsQ0FBQyxZQUFJLEVBQUUsd0JBQWdCLEVBQUUsU0FBUyxDQUFDO2FBQzdDLFNBQVMsQ0FBQyxTQUFTLEVBQUUsR0FBRyxFQUFFLENBQUMsSUFBSSxFQUFFLEVBQUUsSUFBSSxDQUFDLElBQUksQ0FBQyxDQUFDO0lBQ25ELENBQUMsRUFBRSxLQUFLLENBQUMsQ0FBQztBQUNaLENBQUMsQ0FBQyxDQUFDIiwic291cmNlc0NvbnRlbnQiOlsiLyoqXG4gKiBAbGljZW5zZVxuICogQ29weXJpZ2h0IEdvb2dsZSBJbmMuIEFsbCBSaWdodHMgUmVzZXJ2ZWQuXG4gKlxuICogVXNlIG9mIHRoaXMgc291cmNlIGNvZGUgaXMgZ292ZXJuZWQgYnkgYW4gTUlULXN0eWxlIGxpY2Vuc2UgdGhhdCBjYW4gYmVcbiAqIGZvdW5kIGluIHRoZSBMSUNFTlNFIGZpbGUgYXQgaHR0cHM6Ly9hbmd1bGFyLmlvL2xpY2Vuc2VcbiAqL1xuXG5pbXBvcnQgeyBEZWZhdWx0VGltZW91dCwgVGVzdExvZ2dlciwgcnVuVGFyZ2V0U3BlYyB9IGZyb20gJ0Bhbmd1bGFyLWRldmtpdC9hcmNoaXRlY3QvdGVzdGluZyc7XG5pbXBvcnQgeyBub3JtYWxpemUsIHZpcnR1YWxGcyB9IGZyb20gJ0Bhbmd1bGFyLWRldmtpdC9jb3JlJztcbmltcG9ydCB7IHRhcCB9IGZyb20gJ3J4anMvb3BlcmF0b3JzJztcbmltcG9ydCB7IFRzbGludEJ1aWxkZXJPcHRpb25zIH0gZnJvbSAnLi4vLi4vc3JjJztcbmltcG9ydCB7IGhvc3QsIHRzbGludFRhcmdldFNwZWMgfSBmcm9tICcuLi91dGlscyc7XG5cblxuZGVzY3JpYmUoJ1RzbGludCBUYXJnZXQnLCAoKSA9PiB7XG4gIGNvbnN0IGZpbGVzV2l0aEVycm9ycyA9IHsgJ3NyYy9mb28udHMnOiAnY29uc3QgZm9vID0gXCJcIjtcXG4nIH07XG5cbiAgYmVmb3JlRWFjaChkb25lID0+IGhvc3QuaW5pdGlhbGl6ZSgpLnRvUHJvbWlzZSgpLnRoZW4oZG9uZSwgZG9uZS5mYWlsKSk7XG4gIGFmdGVyRWFjaChkb25lID0+IGhvc3QucmVzdG9yZSgpLnRvUHJvbWlzZSgpLnRoZW4oZG9uZSwgZG9uZS5mYWlsKSk7XG5cbiAgaXQoJ3dvcmtzJywgKGRvbmUpID0+IHtcbiAgICBydW5UYXJnZXRTcGVjKGhvc3QsIHRzbGludFRhcmdldFNwZWMpLnBpcGUoXG4gICAgICB0YXAoKGJ1aWxkRXZlbnQpID0+IGV4cGVjdChidWlsZEV2ZW50LnN1Y2Nlc3MpLnRvQmUodHJ1ZSkpLFxuICAgICkudG9Qcm9taXNlKCkudGhlbihkb25lLCBkb25lLmZhaWwpO1xuICB9LCAzMDAwMCk7XG5cbiAgaXQoJ3Nob3VsZCByZXBvcnQgbGludCBlcnJvciBvbmNlJywgKGRvbmUpID0+IHtcbiAgICBob3N0LndyaXRlTXVsdGlwbGVGaWxlcyh7J3NyYy9hcHAvYXBwLmNvbXBvbmVudC50cyc6ICdjb25zdCBmb28gPSBcIlwiO1xcbicgfSk7XG4gICAgY29uc3QgbG9nZ2VyID0gbmV3IFRlc3RMb2dnZXIoJ2xpbnQtZXJyb3InKTtcblxuICAgIHJ1blRhcmdldFNwZWMoaG9zdCwgdHNsaW50VGFyZ2V0U3BlYywgdW5kZWZpbmVkLCBEZWZhdWx0VGltZW91dCwgbG9nZ2VyKS5waXBlKFxuICAgICAgdGFwKChidWlsZEV2ZW50KSA9PiBleHBlY3QoYnVpbGRFdmVudC5zdWNjZXNzKS50b0JlKGZhbHNlKSksXG4gICAgICB0YXAoKCkgPT4ge1xuICAgICAgICAvLyB0aGlzIGlzIHRvIG1ha2Ugc3VyZSB0aGVyZSBhcmUgbm8gZHVwbGljYXRlc1xuICAgICAgICBleHBlY3QobG9nZ2VyLmluY2x1ZGVzKGBcIiBzaG91bGQgYmUgXFwnXFxuRVJST1JgKSkudG9CZShmYWxzZSk7XG5cbiAgICAgICAgZXhwZWN0KGxvZ2dlci5pbmNsdWRlcyhgXCIgc2hvdWxkIGJlICdgKSkudG9CZSh0cnVlKTtcbiAgICAgICAgZXhwZWN0KGxvZ2dlci5pbmNsdWRlcyhgTGludCBlcnJvcnMgZm91bmQgaW4gdGhlIGxpc3RlZCBmaWxlc2ApKS50b0JlKHRydWUpO1xuICAgICAgfSksXG4gICAgKS50b1Byb21pc2UoKS50aGVuKGRvbmUsIGRvbmUuZmFpbCk7XG4gIH0sIDMwMDAwKTtcblxuICBpdCgnc3VwcG9ydHMgZXhjbHVkZScsIChkb25lKSA9PiB7XG4gICAgaG9zdC53cml0ZU11bHRpcGxlRmlsZXMoZmlsZXNXaXRoRXJyb3JzKTtcbiAgICBjb25zdCBvdmVycmlkZXM6IFBhcnRpYWw8VHNsaW50QnVpbGRlck9wdGlvbnM+ID0geyBleGNsdWRlOiBbJyoqL2Zvby50cyddIH07XG5cbiAgICBydW5UYXJnZXRTcGVjKGhvc3QsIHRzbGludFRhcmdldFNwZWMsIG92ZXJyaWRlcykucGlwZShcbiAgICAgIHRhcCgoYnVpbGRFdmVudCkgPT4gZXhwZWN0KGJ1aWxkRXZlbnQuc3VjY2VzcykudG9CZSh0cnVlKSksXG4gICAgKS50b1Byb21pc2UoKS50aGVuKGRvbmUsIGRvbmUuZmFpbCk7XG4gIH0sIDMwMDAwKTtcblxuICBpdCgnc3VwcG9ydHMgZml4JywgKGRvbmUpID0+IHtcbiAgICBob3N0LndyaXRlTXVsdGlwbGVGaWxlcyhmaWxlc1dpdGhFcnJvcnMpO1xuICAgIGNvbnN0IG92ZXJyaWRlczogUGFydGlhbDxUc2xpbnRCdWlsZGVyT3B0aW9ucz4gPSB7IGZpeDogdHJ1ZSB9O1xuXG4gICAgcnVuVGFyZ2V0U3BlYyhob3N0LCB0c2xpbnRUYXJnZXRTcGVjLCBvdmVycmlkZXMpLnBpcGUoXG4gICAgICB0YXAoKGJ1aWxkRXZlbnQpID0+IGV4cGVjdChidWlsZEV2ZW50LnN1Y2Nlc3MpLnRvQmUodHJ1ZSkpLFxuICAgICAgdGFwKCgpID0+IHtcbiAgICAgICAgY29uc3QgZmlsZU5hbWUgPSBub3JtYWxpemUoJ3NyYy9mb28udHMnKTtcbiAgICAgICAgY29uc3QgY29udGVudCA9IHZpcnR1YWxGcy5maWxlQnVmZmVyVG9TdHJpbmcoaG9zdC5zY29wZWRTeW5jKCkucmVhZChmaWxlTmFtZSkpO1xuICAgICAgICBleHBlY3QoY29udGVudCkudG9Db250YWluKGBjb25zdCBmb28gPSAnJztgKTtcbiAgICAgIH0pLFxuICAgICkudG9Qcm9taXNlKCkudGhlbihkb25lLCBkb25lLmZhaWwpO1xuICB9LCAzMDAwMCk7XG5cbiAgaXQoJ3N1cHBvcnRzIGZvcmNlJywgKGRvbmUpID0+IHtcbiAgICBob3N0LndyaXRlTXVsdGlwbGVGaWxlcyhmaWxlc1dpdGhFcnJvcnMpO1xuICAgIGNvbnN0IGxvZ2dlciA9IG5ldyBUZXN0TG9nZ2VyKCdsaW50LWZvcmNlJyk7XG4gICAgY29uc3Qgb3ZlcnJpZGVzOiBQYXJ0aWFsPFRzbGludEJ1aWxkZXJPcHRpb25zPiA9IHsgZm9yY2U6IHRydWUgfTtcblxuICAgIHJ1blRhcmdldFNwZWMoaG9zdCwgdHNsaW50VGFyZ2V0U3BlYywgb3ZlcnJpZGVzLCBEZWZhdWx0VGltZW91dCwgbG9nZ2VyKS5waXBlKFxuICAgICAgdGFwKChidWlsZEV2ZW50KSA9PiBleHBlY3QoYnVpbGRFdmVudC5zdWNjZXNzKS50b0JlKHRydWUpKSxcbiAgICAgIHRhcCgoKSA9PiB7XG4gICAgICAgIGV4cGVjdChsb2dnZXIuaW5jbHVkZXMoYFwiIHNob3VsZCBiZSAnYCkpLnRvQmUodHJ1ZSk7XG4gICAgICAgIGV4cGVjdChsb2dnZXIuaW5jbHVkZXMoYExpbnQgZXJyb3JzIGZvdW5kIGluIHRoZSBsaXN0ZWQgZmlsZXNgKSkudG9CZSh0cnVlKTtcbiAgICAgIH0pLFxuICAgICkudG9Qcm9taXNlKCkudGhlbihkb25lLCBkb25lLmZhaWwpO1xuICB9LCAzMDAwMCk7XG5cbiAgaXQoJ3N1cHBvcnRzIGZvcm1hdCcsIChkb25lKSA9PiB7XG4gICAgaG9zdC53cml0ZU11bHRpcGxlRmlsZXMoZmlsZXNXaXRoRXJyb3JzKTtcbiAgICBjb25zdCBsb2dnZXIgPSBuZXcgVGVzdExvZ2dlcignbGludC1mb3JtYXQnKTtcbiAgICBjb25zdCBvdmVycmlkZXM6IFBhcnRpYWw8VHNsaW50QnVpbGRlck9wdGlvbnM+ID0geyBmb3JtYXQ6ICdzdHlsaXNoJyB9O1xuXG4gICAgcnVuVGFyZ2V0U3BlYyhob3N0LCB0c2xpbnRUYXJnZXRTcGVjLCBvdmVycmlkZXMsIERlZmF1bHRUaW1lb3V0LCBsb2dnZXIpLnBpcGUoXG4gICAgICB0YXAoKGJ1aWxkRXZlbnQpID0+IGV4cGVjdChidWlsZEV2ZW50LnN1Y2Nlc3MpLnRvQmUoZmFsc2UpKSxcbiAgICAgIHRhcCgoKSA9PiB7XG4gICAgICAgIGV4cGVjdChsb2dnZXIuaW5jbHVkZXMoYHF1b3RlbWFya2ApKS50b0JlKHRydWUpO1xuICAgICAgfSksXG4gICAgKS50b1Byb21pc2UoKS50aGVuKGRvbmUsIGRvbmUuZmFpbCk7XG4gIH0sIDMwMDAwKTtcblxuICBpdCgnc3VwcG9ydHMgZmluZGluZyBjb25maWdzJywgKGRvbmUpID0+IHtcbiAgICBob3N0LndyaXRlTXVsdGlwbGVGaWxlcyh7XG4gICAgICAnc3JjL2FwcC9mb28vZm9vLnRzJzogYGNvbnN0IGZvbyA9ICcnO1xcbmAsXG4gICAgICAnc3JjL2FwcC9mb28vdHNsaW50Lmpzb24nOiBgXG4gICAgICAgIHtcbiAgICAgICAgICBcInJ1bGVzXCI6IHtcbiAgICAgICAgICAgIFwicXVvdGVtYXJrXCI6IFtcbiAgICAgICAgICAgICAgdHJ1ZSxcbiAgICAgICAgICAgICAgXCJkb3VibGVcIlxuICAgICAgICAgICAgXVxuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgYCxcbiAgICB9KTtcbiAgICBjb25zdCBvdmVycmlkZXM6IFBhcnRpYWw8VHNsaW50QnVpbGRlck9wdGlvbnM+ID0geyB0c2xpbnRDb25maWc6IHVuZGVmaW5lZCB9O1xuXG4gICAgcnVuVGFyZ2V0U3BlYyhob3N0LCB0c2xpbnRUYXJnZXRTcGVjLCBvdmVycmlkZXMpLnBpcGUoXG4gICAgICB0YXAoKGJ1aWxkRXZlbnQpID0+IGV4cGVjdChidWlsZEV2ZW50LnN1Y2Nlc3MpLnRvQmUoZmFsc2UpKSxcbiAgICApLnRvUHJvbWlzZSgpLnRoZW4oZG9uZSwgZG9uZS5mYWlsKTtcbiAgfSwgMzAwMDApO1xuXG4gIGl0KCdzdXBwb3J0cyBvdmVycmlkaW5nIGNvbmZpZ3MnLCAoZG9uZSkgPT4ge1xuICAgIGhvc3Qud3JpdGVNdWx0aXBsZUZpbGVzKHtcbiAgICAgICdzcmMvYXBwL2Zvby9mb28udHMnOiBgY29uc3QgZm9vID0gJyc7XFxuYCxcbiAgICAgICdzcmMvYXBwL2Zvby90c2xpbnQuanNvbic6IGBcbiAgICAgICAge1xuICAgICAgICAgIFwicnVsZXNcIjoge1xuICAgICAgICAgICAgXCJxdW90ZW1hcmtcIjogW1xuICAgICAgICAgICAgICB0cnVlLFxuICAgICAgICAgICAgICBcImRvdWJsZVwiXG4gICAgICAgICAgICBdXG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICBgLFxuICAgIH0pO1xuICAgIGNvbnN0IG92ZXJyaWRlczogUGFydGlhbDxUc2xpbnRCdWlsZGVyT3B0aW9ucz4gPSB7IHRzbGludENvbmZpZzogJ3RzbGludC5qc29uJyB9O1xuXG4gICAgcnVuVGFyZ2V0U3BlYyhob3N0LCB0c2xpbnRUYXJnZXRTcGVjLCBvdmVycmlkZXMpLnBpcGUoXG4gICAgICB0YXAoKGJ1aWxkRXZlbnQpID0+IGV4cGVjdChidWlsZEV2ZW50LnN1Y2Nlc3MpLnRvQmUodHJ1ZSkpLFxuICAgICkudG9Qcm9taXNlKCkudGhlbihkb25lLCBkb25lLmZhaWwpO1xuICB9LCAzMDAwMCk7XG5cbiAgaXQoJ3N1cHBvcnRzIHVzaW5nIGZpbGVzIHdpdGggbm8gcHJvamVjdCcsIChkb25lKSA9PiB7XG4gICAgY29uc3Qgb3ZlcnJpZGVzOiBQYXJ0aWFsPFRzbGludEJ1aWxkZXJPcHRpb25zPiA9IHtcbiAgICAgIHRzQ29uZmlnOiB1bmRlZmluZWQsXG4gICAgICBmaWxlczogWydzcmMvYXBwLyoqLyoudHMnXSxcbiAgICB9O1xuXG4gICAgcnVuVGFyZ2V0U3BlYyhob3N0LCB0c2xpbnRUYXJnZXRTcGVjLCBvdmVycmlkZXMpLnBpcGUoXG4gICAgICB0YXAoKGJ1aWxkRXZlbnQpID0+IGV4cGVjdChidWlsZEV2ZW50LnN1Y2Nlc3MpLnRvQmUodHJ1ZSkpLFxuICAgICkudG9Qcm9taXNlKCkudGhlbihkb25lLCBkb25lLmZhaWwpO1xuICB9LCAzMDAwMCk7XG5cbiAgaXQoJ3N1cHBvcnRzIHVzaW5nIG9uZSBwcm9qZWN0IGFzIGEgc3RyaW5nJywgKGRvbmUpID0+IHtcbiAgICBjb25zdCBvdmVycmlkZXM6IFBhcnRpYWw8VHNsaW50QnVpbGRlck9wdGlvbnM+ID0ge1xuICAgICAgdHNDb25maWc6ICdzcmMvdHNjb25maWcuYXBwLmpzb24nLFxuICAgIH07XG5cbiAgICBydW5UYXJnZXRTcGVjKGhvc3QsIHRzbGludFRhcmdldFNwZWMsIG92ZXJyaWRlcykucGlwZShcbiAgICAgIHRhcCgoYnVpbGRFdmVudCkgPT4gZXhwZWN0KGJ1aWxkRXZlbnQuc3VjY2VzcykudG9CZSh0cnVlKSksXG4gICAgKS50b1Byb21pc2UoKS50aGVuKGRvbmUsIGRvbmUuZmFpbCk7XG4gIH0sIDMwMDAwKTtcblxuICBpdCgnc3VwcG9ydHMgdXNpbmcgb25lIHByb2plY3QgYXMgYW4gYXJyYXknLCAoZG9uZSkgPT4ge1xuICAgIGNvbnN0IG92ZXJyaWRlczogUGFydGlhbDxUc2xpbnRCdWlsZGVyT3B0aW9ucz4gPSB7XG4gICAgICB0c0NvbmZpZzogWydzcmMvdHNjb25maWcuYXBwLmpzb24nXSxcbiAgICB9O1xuXG4gICAgcnVuVGFyZ2V0U3BlYyhob3N0LCB0c2xpbnRUYXJnZXRTcGVjLCBvdmVycmlkZXMpLnBpcGUoXG4gICAgICB0YXAoKGJ1aWxkRXZlbnQpID0+IGV4cGVjdChidWlsZEV2ZW50LnN1Y2Nlc3MpLnRvQmUodHJ1ZSkpLFxuICAgICkudG9Qcm9taXNlKCkudGhlbihkb25lLCBkb25lLmZhaWwpO1xuICB9LCAzMDAwMCk7XG5cbiAgaXQoJ3N1cHBvcnRzIHVzaW5nIHR3byBwcm9qZWN0cycsIChkb25lKSA9PiB7XG4gICAgY29uc3Qgb3ZlcnJpZGVzOiBQYXJ0aWFsPFRzbGludEJ1aWxkZXJPcHRpb25zPiA9IHtcbiAgICAgIHRzQ29uZmlnOiBbJ3NyYy90c2NvbmZpZy5hcHAuanNvbicsICdzcmMvdHNjb25maWcuc3BlYy5qc29uJ10sXG4gICAgfTtcblxuICAgIHJ1blRhcmdldFNwZWMoaG9zdCwgdHNsaW50VGFyZ2V0U3BlYywgb3ZlcnJpZGVzKS5waXBlKFxuICAgICAgdGFwKChidWlsZEV2ZW50KSA9PiBleHBlY3QoYnVpbGRFdmVudC5zdWNjZXNzKS50b0JlKHRydWUpKSxcbiAgICApLnRvUHJvbWlzZSgpLnRoZW4oZG9uZSwgZG9uZS5mYWlsKTtcbiAgfSwgMzAwMDApO1xuXG4gIGl0KCdlcnJvcnMgd2hlbiB0eXBlIGNoZWNraW5nIGlzIHVzZWQgd2l0aG91dCBhIHByb2plY3QnLCAoZG9uZSkgPT4ge1xuICAgIGNvbnN0IG92ZXJyaWRlczogUGFydGlhbDxUc2xpbnRCdWlsZGVyT3B0aW9ucz4gPSB7XG4gICAgICB0c0NvbmZpZzogdW5kZWZpbmVkLFxuICAgICAgdHlwZUNoZWNrOiB0cnVlLFxuICAgIH07XG5cbiAgICBydW5UYXJnZXRTcGVjKGhvc3QsIHRzbGludFRhcmdldFNwZWMsIG92ZXJyaWRlcylcbiAgICAgIC5zdWJzY3JpYmUodW5kZWZpbmVkLCAoKSA9PiBkb25lKCksIGRvbmUuZmFpbCk7XG4gIH0sIDMwMDAwKTtcbn0pO1xuIl19